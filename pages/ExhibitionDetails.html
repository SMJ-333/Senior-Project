<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exhibition Details - ATHAR Museum</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_API_KEY"></script>
    <!-- Arabic Font -->
    <link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&display=swap" rel="stylesheet">

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'ar,en',
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
    </script>

    <!-- Load translation helper -->
    <script src="translation-helper.js"></script>
    
    <style>
       :root {
            --primary-dark: #653025;
            --primary-light: #8d2e1d;
            --accent: #b08d57;
            --accent-light: #d4b483;
            --neutral-light: #f4f1e3;
            --neutral-dark: #4a3c2a;
            --text-dark: #3b2f23;
            --text-light: #7c6f57;
            --white: #fdfaf4;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--neutral-light);
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            line-height: 1.2;
        }

        nav {
            background: var(--white);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1300px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "◈";
            color: var(--accent);
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 80%;
        }

        .account-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--white);
            color: var(--primary-dark);
            font-size: 1.2rem;
            border: 2px solid var(--accent);
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
        }

        .account-icon:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 15px rgba(26, 54, 93, 0.25);
        }

        .page-content {
            padding-top: 6rem;
            min-height: 100vh;
        }

        .hero {
            background: linear-gradient(120deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            padding: 6rem 0 4rem;
            text-align: center;
            color: var(--white);
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
        }

        .hero-content p {
            font-size: 1.3rem;
            font-weight: 300;
            opacity: 0.95;
            line-height: 1.8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .exhibition-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 4rem;
        }

        .overview-content {
            background: var(--white);
            border-radius: 16px;
            padding: 3rem;
            box-shadow: var(--shadow);
        }

        .overview-content h2 {
            color: var(--primary-dark);
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .overview-content h2 .material-icons {
            color: var(--accent);
            font-size: 2rem;
        }

        .timeline-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary-dark);
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            font-weight: 600;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .overview-text {
            color: var(--text-dark);
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-box {
            background: var(--neutral-light);
            padding: 1.2rem;
            border-radius: 12px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-box:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
            font-family: 'Playfair Display', serif;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.3rem;
        }

        .featured-images {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .featured-images h3 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .featured-images h3 .material-icons {
            color: var(--accent);
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            flex: 1;
        }

        .featured-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            aspect-ratio: 1;
        }

        .featured-item:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .featured-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .featured-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            padding: 1rem;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .featured-action {
            margin-top: 1.5rem;
            text-align: center;
        }

        .themes-section {
            background: var(--white);
            border-radius: 16px;
            padding: 3rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow);
        }

        .themes-section h2 {
            color: var(--primary-dark);
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .theme-card {
            background: linear-gradient(135deg, var(--neutral-light) 0%, #ede8db 100%);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .theme-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .theme-title {
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 1rem;
        }

        .theme-count {
            color: var(--accent);
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 0.5rem;
            font-family: 'Playfair Display', serif;
        }

        .curator-section {
            background: linear-gradient(135deg, #f7f3e9 0%, #ede8db 100%);
            border-radius: 16px;
            padding: 3rem;
            margin-bottom: 3rem;
            border-left: 6px solid var(--accent);
            box-shadow: var(--shadow);
        }

        .curator-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .curator-header .material-icons {
            font-size: 3rem;
            color: var(--accent);
        }

        .curator-header h2 {
            color: var(--primary-dark);
            font-size: 2rem;
        }

        .curator-text {
            color: var(--text-dark);
            font-size: 1.1rem;
            line-height: 1.9;
            font-style: italic;
            padding-left: 2rem;
            /* border-left: 3px solid var(--accent-light); */
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            font-size: 1.05rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary-dark);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .spinner {
            border: 4px solid var(--neutral-light);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .no-results {
            text-align: center;
            padding: 5rem 2rem;
            color: var(--text-light);
        }

        .no-results .material-icons {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            opacity: 0.4;
        }

        footer {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 4rem 0 2rem;
            margin-top: 5rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h3 {
            color: var(--accent);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .footer-section p {
            margin-bottom: 0.8rem;
            opacity: 0.9;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
        }

        @media (max-width: 1024px) {
            .exhibition-overview {
                grid-template-columns: 1fr;
            }

            .featured-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .exhibition-overview {
                gap: 2rem;
            }

            .overview-content,
            .themes-section,
            .curator-section,
            .featured-images {
                padding: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .themes-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }

        .accessibility-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .accessibility-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-dark);
            color: var(--white);
            border: 3px solid var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .accessibility-btn:hover {
            transform: scale(1.1);
            background: var(--primary-light);
        }

        .accessibility-btn.active {
            background: var(--accent);
            color: var(--primary-dark);
        }

        .accessibility-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            min-width: 250px;
            display: none;
        }

        .accessibility-menu.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .accessibility-menu h3 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .menu-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--neutral-light);
            transition: var(--transition);
        }

        .menu-option:last-child {
            border-bottom: none;
        }

        .menu-option label {
            color: var(--text-dark);
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-option:has(input:disabled) {
            opacity: 0.5;
        }

        .menu-option:has(input:disabled) label {
            cursor: not-allowed;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        .toggle-switch input:disabled+.slider {
            background-color: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .toggle-switch input:disabled+.slider:before {
            background-color: #f5f5f5;
        }

        .speed-control {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.8rem 0;
        }

        .speed-control input[type="range"] {
            width: 100%;
            accent-color: var(--accent);
        }

        .speed-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .sr-highlight {
            outline: 3px solid var(--accent) !important;
            outline-offset: 2px;
            background-color: rgba(176, 141, 87, 0.1) !important;
        }

        @media (max-width: 768px) {
            .accessibility-controls {
                bottom: 15px;
                right: 15px;
            }

            .accessibility-btn {
                width: 55px;
                height: 55px;
            }

            .accessibility-menu {
                right: -10px;
                min-width: 220px;
            }
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-container">
            <a href="Home.html" class="logo">
                <span class="english-only notranslate">ATHAR Museum</span>
                <span class="arabic-only notranslate"
                    style="font-family: 'Aref Ruqaa', serif; font-size: 30px;">أثــــر</span>
            </a>

            <ul class="nav-links">
                <li>
                    <a href="Home.html">
                        <span class="english-only notranslate">Home</span>
                        <span class="arabic-only notranslate">الصفحة الرئيسية</span>
                    </a>
                </li>
                <li>
                    <a href="AboutUs.html">
                        <span class="english-only notranslate">About Us</span>
                        <span class="arabic-only notranslate">من نحن</span>
                    </a>
                </li>
                <li>
                    <a href="Events.html">
                        <span class="english-only notranslate">Events</span>
                        <span class="arabic-only notranslate">الفعاليات</span>
                    </a>
                </li>
                <li>
                    <a href="Ticketing.html">
                        <span class="english-only notranslate">Ticketing</span>
                        <span class="arabic-only notranslate">التذاكر</span>
                    </a>
                </li>
                <li>
                    <a href="News.html">
                        <span class="english-only notranslate">News</span>
                        <span class="arabic-only notranslate">الأخبار</span>
                    </a>
                </li>
                <li>
                    <a href="Exhibitions.html" class="active">
                        <span class="english-only notranslate">Exhibitions</span>
                        <span class="arabic-only notranslate">المعارض</span>
                    </a>
                </li>
                <li>
                    <a href="Gallery.html">
                        <span class="english-only notranslate">Gallery</span>
                        <span class="arabic-only notranslate">مجموعة التراث</span>
                    </a>
                </li>
            </ul>

            <div style="display: flex; align-items: center; gap: 1rem;">
                <div id="google_translate_element" style="display: none;"></div>

                <button class="language-toggle" id="language-toggle" onclick="translateToArabic()"
                    title="Switch Language">
                    <span class="material-icons notranslate">translate</span>
                    <span class="translate-text" id="lang-text">العربية</span>
                </button>

                <a href="Account.html" class="account-icon" title="My Account">
                    <span class="material-icons">person</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="page-content">
        <section class="hero">
            <div class="hero-content">
                <h1 id="exhibition-title">Loading...</h1>
                <p id="exhibition-description">Exploring the collection...</p>
            </div>
        </section>

        <div class="container">
            <div class="exhibition-overview">
                <div class="overview-content">
                    <h2>
                        <span class="material-icons">info</span>
                        About This Exhibition
                    </h2>
                    <div class="timeline-badge">
                        <span class="material-icons" style="font-size: 1.2rem;">schedule</span>
                        <span id="timeline-text">Loading...</span>
                    </div>
                    <p class="overview-text" id="detailed-description">Loading exhibition details...</p>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number" id="artifact-count">0</div>
                            <div class="stat-label">Artifacts</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="classification-count">0</div>
                            <div class="stat-label">Categories</div>
                        </div>
                    </div>
                </div>

                <div class="featured-images">
                    <h3>
                        <span class="material-icons">collections</span>
                        Featured Pieces
                    </h3>
                    <div class="featured-grid" id="featured-grid">
                        <div class="loading" style="grid-column: 1 / -1;">
                            <div class="spinner"></div>
                            Loading featured items...
                        </div>
                    </div>
                    <div class="featured-action">
                        <a href="Gallery.html" class="btn btn-primary" id="gallery-link">
                            <span class="material-icons">view_module</span>
                            Explore Full Gallery
                        </a>
                    </div>
                </div>
            </div>

            <div class="themes-section">
                <h2>Artifact Classifications</h2>
                <div id="classifications-loading" class="loading">
                    <div class="spinner"></div>
                    Loading classifications...
                </div>
                <div class="themes-grid" id="themes-grid"></div>
            </div>

            <div class="curator-section">
                <div class="curator-header">
                    <span class="material-icons">format_quote</span>
                    <h2>Curator's Perspective</h2>
                </div>
                <p class="curator-text" id="curator-text">Loading curator's note...</p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-section">
                    <h3>Visit Us</h3>
                    <p>123 Museum Boulevard</p>
                    <p>Cultural District</p>
                    <p>City, State 12345</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
                <div class="footer-section">
                    <h3>Hours</h3>
                    <p>Monday - Friday: 9:00 AM - 6:00 PM</p>
                    <p>Saturday - Sunday: 10:00 AM - 8:00 PM</p>
                    <p>Closed on major holidays</p>
                </div>
                <div class="footer-section">
                    <h3>Admission</h3>
                    <p>Adults: $15</p>
                    <p>Students/Seniors: $12</p>
                    <p>Children under 12: Free</p>
                    <p>Members: Always Free</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ATHAR Museum. All rights reserved.</p>
            </div>
    </footer>
    </div>

    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import './notification-system.js';

        const exhibitionData = {
            'Arab Heritage': {
                description: 'Discover the golden age of Islamic civilization through calligraphy, manuscripts, and architectural elements that showcase the Arab world\'s contributions to science, literature, and art.',
                detailedDescription: 'The Arab Heritage collection spans over a millennium of cultural achievement, from the early Islamic period through the golden age of the Abbasid Caliphate. These artifacts illuminate the profound impact of Arab scholars, artists, and thinkers on world civilization. From the House of Wisdom in Baghdad to the grand mosques of Damascus and Cairo, Arab culture has been a beacon of learning and artistic excellence.',
                timeline: '7th - 19th Century CE',
                curatorNote: 'This collection showcases the remarkable intellectual and artistic achievements of Arab civilization. From intricate geometric patterns to profound literary works, these pieces remind us that beauty and knowledge have always been intertwined in Islamic culture. The sophistication of Arabic calligraphy, the precision of astronomical instruments, and the elegance of architectural designs all speak to a civilization that valued both aesthetics and intellect.'
            },
            'Persian Heritage': {
                description: 'Journey through the splendor of ancient Persia with exquisite miniature paintings, intricate tilework, and legendary poetry manuscripts from one of history\'s greatest empires.',
                detailedDescription: 'The Persian collection celebrates one of the world\'s oldest continuous civilizations, spanning from the mighty Achaemenid Empire through the artistic zenith of the Safavid dynasty. Persian culture has profoundly influenced art, poetry, and philosophy across vast regions. The miniature paintings reveal stories of legendary heroes and mystical romances, while the tilework demonstrates unparalleled technical mastery.',
                timeline: '550 BCE - 18th Century CE',
                curatorNote: 'Persian art speaks to the soul with its delicate miniatures and profound poetry. Each piece in this collection reflects the Persian devotion to beauty, wisdom, and the celebration of human experience through artistic expression. The works of masters like Rumi and Hafez continue to inspire, while the visual arts demonstrate a culture that saw no separation between the material and the spiritual.'
            },
            'Indian Heritage': {
                description: 'Experience the vibrant colors and spiritual depth of Indian art, from Mughal miniatures to sacred sculptures, textiles, and ceremonial objects spanning millennia.',
                detailedDescription: 'The Indian Heritage collection encompasses the incredible diversity of the subcontinent\'s artistic traditions. From ancient temple sculptures carved in stone to the refined court paintings of the Mughal era, these works reflect India\'s rich spiritual and cultural heritage. The collection includes sacred texts, ceremonial objects, intricate textiles, and devotional art that showcase the region\'s deep philosophical traditions.',
                timeline: '3rd Century BCE - 19th Century CE',
                curatorNote: 'Indian art is characterized by its spiritual depth and vibrant expression. These pieces demonstrate how art and devotion merge seamlessly in Indian culture, creating works that are both beautiful and deeply meaningful. Whether in the serene face of a Buddha statue or the dynamic energy of Hindu deities, Indian art invites contemplation and celebrates the divine in all forms.'
            },
            'Andalusian Heritage': {
                description: 'Step into Al-Andalus, where Islamic, Christian, and Jewish cultures merged to create a unique civilization of tolerance, innovation, and artistic brilliance.',
                detailedDescription: 'The Andalusian collection represents a golden age of cultural synthesis in medieval Iberia. For nearly 800 years, Al-Andalus was a beacon of learning, religious tolerance, and artistic innovation that influenced all of Europe. This period saw remarkable achievements in architecture, philosophy, music, and the sciences. The Great Mosque of Córdoba and the Alhambra palace stand as testaments to this era\'s artistic genius.',
                timeline: '711 - 1492 CE',
                curatorNote: 'Andalusian art represents a unique moment in history when different cultures coexisted and enriched one another. These pieces remind us of the power of cultural exchange and the beauty that emerges from diversity. The geometric patterns, arabesque designs, and muqarnas vaulting showcase a civilization that achieved harmony through difference.'
            },
            'Turkish Heritage': {
                description: 'Witness the grandeur of the Ottoman Empire through imperial treasures, ceramics from Iznik, elaborate textiles, and military regalia that defined an era.',
                detailedDescription: 'The Turkish collection showcases the magnificence of the Ottoman Empire, which ruled for over six centuries as a bridge between East and West. These artifacts reflect the empire\'s sophisticated court culture and artistic patronage. The famous Iznik ceramics, with their vibrant blue and white designs, represent the peak of Ottoman artistic achievement, while elaborate textiles and imperial treasures reveal the wealth and power of the sultans.',
                timeline: '1299 - 1922 CE',
                curatorNote: 'Ottoman art reflects an empire that valued both martial prowess and refined aesthetics. From the famous Iznik ceramics to elaborate textiles, these pieces show how the Ottomans synthesized influences from across their vast territories—Persian, Arab, Byzantine, and European—creating a unique and instantly recognizable artistic tradition.'
            },
            'Others': {
                description: 'Explore diverse collections from cultures across Asia, Africa, and beyond. From ancient trade routes to contemporary cultural exchanges that connect our world.',
                detailedDescription: 'This collection celebrates the diversity of human creativity across regions and time periods. These artifacts demonstrate the interconnectedness of world cultures through trade, migration, and cultural exchange. From the Silk Road to maritime trade routes, these pieces tell stories of how ideas, techniques, and artistic traditions traveled and transformed across continents.',
                timeline: 'Various Periods',
                curatorNote: 'These diverse pieces remind us that every culture has contributed to the rich tapestry of human civilization. Together, they tell stories of connection, innovation, and the universal human impulse to create beauty. Each artifact bridges geographical and temporal distances, revealing our shared humanity.'
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        let exhibitionName = urlParams.get('exhibition');

        if (exhibitionName) {
            exhibitionName = exhibitionName.trim();
        }

        function updatePageHeader() {
            const data = exhibitionData[exhibitionName] || {};

            document.getElementById('exhibition-title').textContent = exhibitionName || 'Exhibition';
            document.getElementById('exhibition-description').textContent = data.description || 'Explore our curated collection of artifacts.';
            document.getElementById('detailed-description').textContent = data.detailedDescription || data.description || 'Explore our curated collection of artifacts.';
            document.getElementById('timeline-text').textContent = data.timeline || 'Various Periods';
            document.getElementById('curator-text').textContent = data.curatorNote || 'Each piece in this collection has been carefully selected to tell the story of this remarkable culture.';
            document.title = `${exhibitionName} - ATHAR Museum`;

            // Update gallery link
            const galleryLink = document.getElementById('gallery-link');
            galleryLink.href = `Gallery.html?exhibition=${encodeURIComponent(exhibitionName)}`;
        }

        function updateFeaturedImages(artifacts) {
            const featuredGrid = document.getElementById('featured-grid');

            if (artifacts.length === 0) {
                featuredGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-light);">No featured items available</p>';
                return;
            }

            // Get up to 4 random artifacts for featured display
            const shuffled = [...artifacts].sort(() => 0.5 - Math.random());
            const featured = shuffled.slice(0, 4);

            featuredGrid.innerHTML = featured.map(item => {
                const imageURL = item.imageURL || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"%3E%3Crect fill="%23e2e8f0" width="200" height="200"/%3E%3Ctext x="100" y="100" text-anchor="middle" fill="%23718096" font-size="16"%3ENo Image%3C/text%3E%3C/svg%3E';
                const title = item.title || 'Untitled';

                return `
            <div class="featured-item">
                <img src="${imageURL}" alt="${title}" onerror="...">
                <div class="featured-overlay">${title}</div>
            </div>
        `;
            }).join('');
        }
        function updateClassifications(artifacts) {
            const themesGrid = document.getElementById('themes-grid');
            const classificationsLoading = document.getElementById('classifications-loading');

            // Count artifacts by classification
            const classificationCounts = {};
            artifacts.forEach(item => {
                const classification = item.classification ? item.classification.trim() : 'Unclassified';
                classificationCounts[classification] = (classificationCounts[classification] || 0) + 1;
            });

            // Sort by count (descending)
            const sortedClassifications = Object.entries(classificationCounts)
                .sort((a, b) => b[1] - a[1]);

            classificationsLoading.style.display = 'none';

            if (sortedClassifications.length === 0) {
                themesGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-light);">No classifications available</p>';
                return;
            }

            themesGrid.innerHTML = sortedClassifications.map(([classification, count]) => `
                <div class="theme-card">
                    <div class="theme-title">${classification}</div>
                    <div class="theme-count">${count}</div>
                </div>
            `).join('');

            // Update classification count in stats
            document.getElementById('classification-count').textContent = sortedClassifications.length;
        }

        async function loadExhibitionData() {
            if (!exhibitionName) {
                console.error('No exhibition specified');
                document.getElementById('exhibition-title').textContent = 'Exhibition Not Found';
                return;
            }

            try {
                updatePageHeader();

                // Load artifacts from the database
                const artifactsCollection = collection(db, 'Museum_Collection');
                const querySnapshot = await getDocs(artifactsCollection);

                const artifacts = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();

                    // ✅ Normalize both sides: trim spaces and compare case‑insensitively
                    if (
                        data.Exhibition &&
                        data.Exhibition.trim().toLowerCase() === exhibitionName.trim().toLowerCase()
                    ) {
                        artifacts.push({
                            id: doc.id,
                            ...data
                        });
                    }
                });

                // Update artifact count
                document.getElementById('artifact-count').textContent = artifacts.length;

                // Update featured images
                updateFeaturedImages(artifacts);

                // Update classifications
                updateClassifications(artifacts);

            } catch (error) {
                console.error('Error loading exhibition data:', error);
                document.getElementById('featured-grid').innerHTML =
                    '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-light);">Error loading data</p>';
            }
        }

        // Load data when page loads
        loadExhibitionData()

        // ===== SCREEN READER ACCESSIBILITY SYSTEM =====
        class ScreenReaderSystem {
            constructor() {
                this.isEnabled = false;
                this.isReading = false;
                this.autoReadOnHover = false;
                this.readOnClick = false;
                this.speed = 1.0;
                this.currentElement = null;
                this.hoverTimeout = null;

                this.init();
            }

            init() {
                this.createAccessibilityControls();
                this.loadSettings();
                this.attachEventListeners();
                this.attachSelectListeners();
            }

            attachSelectListeners() {
                // Add listeners to all select elements to read options on keyboard navigation
                document.addEventListener('change', (e) => {
                    if (this.isEnabled && e.target.tagName === 'SELECT') {
                        const selectedOption = e.target.options[e.target.selectedIndex];
                        if (selectedOption) {
                            this.speak(selectedOption.textContent.trim());
                        }
                    }
                });

                // Handle keyboard navigation in selects
                document.addEventListener('keydown', (e) => {
                    if (this.isEnabled && e.target.tagName === 'SELECT') {
                        if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                            setTimeout(() => {
                                const selectedOption = e.target.options[e.target.selectedIndex];
                                if (selectedOption) {
                                    this.speak(selectedOption.textContent.trim());
                                }
                            }, 50);
                        }
                    }
                });

                // Handle hover over options (using mouseenter on SELECT to detect when options are hovered)
                document.addEventListener('mouseenter', (e) => {
                    if (this.isEnabled && this.autoReadOnHover && e.target.tagName === 'OPTION') {
                        const text = e.target.textContent.trim();
                        if (text && text.length > 0 && e.target !== this.currentElement) {
                            this.speak(text);
                            this.currentElement = e.target;
                        }
                    }
                }, true); // Use capture phase

                // Also handle focus events on options
                document.addEventListener('focus', (e) => {
                    if (this.isEnabled && this.autoReadOnHover && e.target.tagName === 'OPTION') {
                        const text = e.target.textContent.trim();
                        if (text && text.length > 0 && e.target !== this.currentElement) {
                            this.speak(text);
                            this.currentElement = e.target;
                        }
                    }
                }, true); // Use capture phase
            }

            createAccessibilityControls() {
                const controls = document.createElement('div');
                controls.className = 'accessibility-controls';
                controls.innerHTML = `
            <button class="accessibility-btn" id="accessibility-toggle" title="Screen Reader Controls" aria-label="Open screen reader controls">
                <span class="material-icons">accessibility_new</span>
            </button>
            <div class="accessibility-menu" id="accessibility-menu" role="menu">
                <h3>Screen Reader</h3>
                
                <div class="menu-option">
                    <label for="enable-reader">Enable Reader</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enable-reader">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="menu-option">
                    <label for="auto-hover">Read on Hover</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-hover" disabled>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="menu-option">
                    <label for="read-click">Read on Click</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="read-click" disabled>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="speed-control">
                    <div class="speed-label">
                        <span>Speech Speed</span>
                        <span id="speed-value">Normal</span>
                    </div>
                    <input type="range" id="speed-control" min="0.5" max="2" step="0.1" value="1">
                </div>
            </div>
        `;
                document.body.appendChild(controls);
            }

            attachEventListeners() {
                document.getElementById('accessibility-toggle').addEventListener('click', () => {
                    const menu = document.getElementById('accessibility-menu');
                    menu.classList.toggle('show');
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.accessibility-controls')) {
                        document.getElementById('accessibility-menu').classList.remove('show');
                    }
                });

                document.getElementById('enable-reader').addEventListener('change', (e) => {
                    this.isEnabled = e.target.checked;
                    const hoverCheckbox = document.getElementById('auto-hover');
                    const clickCheckbox = document.getElementById('read-click');

                    if (this.isEnabled) {
                        hoverCheckbox.disabled = false;
                        clickCheckbox.disabled = false;

                        this.autoReadOnHover = true;
                        this.readOnClick = true;
                        hoverCheckbox.checked = true;
                        clickCheckbox.checked = true;

                        this.speak("Screen reader enabled. Hover over elements to hear them read aloud.");
                        this.enableReader();
                        this.enableHoverReading();
                    } else {
                        hoverCheckbox.disabled = true;
                        clickCheckbox.disabled = true;
                        hoverCheckbox.checked = false;
                        clickCheckbox.checked = false;

                        this.autoReadOnHover = false;
                        this.readOnClick = false;

                        this.speak("Screen reader disabled");
                        this.disableReader();
                    }

                    this.saveSettings();
                });

                document.getElementById('auto-hover').addEventListener('change', (e) => {
                    this.autoReadOnHover = e.target.checked;
                    this.saveSettings();
                    if (this.autoReadOnHover) {
                        this.enableHoverReading();
                    } else {
                        this.disableHoverReading();
                    }
                });

                document.getElementById('read-click').addEventListener('change', (e) => {
                    this.readOnClick = e.target.checked;
                    this.saveSettings();
                });

                document.getElementById('speed-control').addEventListener('input', (e) => {
                    this.speed = parseFloat(e.target.value);
                    this.updateSpeedLabel();
                    this.saveSettings();
                });

                document.addEventListener('keydown', (e) => {
                    if (e.altKey && e.key === 's') {
                        e.preventDefault();
                        this.stopSpeaking();
                    }
                    if (e.altKey && e.key === 'r') {
                        e.preventDefault();
                        const enableCheckbox = document.getElementById('enable-reader');
                        enableCheckbox.checked = !enableCheckbox.checked;
                        enableCheckbox.dispatchEvent(new Event('change'));
                    }
                });
            }

            enableReader() {
                document.body.style.cursor = 'help';
            }

            disableReader() {
                document.body.style.cursor = 'default';
                this.stopSpeaking();
                this.disableHoverReading();
            }

            enableHoverReading() {
                document.addEventListener('mouseover', this.handleHover);
                document.addEventListener('mousemove', this.handleSelectOptions);
            }

            disableHoverReading() {
                document.removeEventListener('mouseover', this.handleHover);
                document.removeEventListener('mousemove', this.handleSelectOptions);
                clearTimeout(this.hoverTimeout);
            }

            handleSelectOptions = (e) => {
                if (!this.isEnabled || !this.autoReadOnHover) return;

                const element = e.target;

                // Skip material icons
                if (element.classList && element.classList.contains('material-icons')) return;

                if (element.tagName === 'OPTION') {
                    clearTimeout(this.hoverTimeout);
                    this.hoverTimeout = setTimeout(() => {
                        if (element !== this.currentElement) {
                            const text = element.textContent.trim();
                            if (text && text.length > 0) {
                                this.speak(text);
                                this.currentElement = element;
                            }
                        }
                    }, 100);
                }
            }

            handleHover = (e) => {
                if (!this.isEnabled || !this.autoReadOnHover) return;

                const element = e.target;

                // Skip material icons
                if (element.classList && element.classList.contains('material-icons')) return;

                clearTimeout(this.hoverTimeout);

                // Use shorter delay for dropdown options
                const delay = element.tagName === 'OPTION' ? 100 : 500;

                this.hoverTimeout = setTimeout(() => {
                    if (element && element !== this.currentElement) {
                        this.readElement(element);
                    }
                }, delay);
            }

            readElement(element) {
                if (!this.isEnabled) return;

                if (['SCRIPT', 'STYLE', 'NOSCRIPT'].includes(element.tagName)) return;
                if (element.offsetParent === null && element.tagName !== 'BODY') return;

                // Skip material icons
                if (element.classList && element.classList.contains('material-icons')) return;

                // Skip if parent is a material icon
                if (element.parentElement && element.parentElement.classList && element.parentElement.classList.contains('material-icons')) return;

                // Skip if element contains only a material icon as child
                const iconChild = element.querySelector('.material-icons');
                if (iconChild && element.textContent.trim() === iconChild.textContent.trim()) return;

                let textToRead = '';
                let isClickable = false;

                const hasClickHandler = element.onclick !== null ||
                    element.hasAttribute('onclick') ||
                    element.style.cursor === 'pointer' ||
                    element.classList.contains('clickable') ||
                    element.hasAttribute('role') && element.getAttribute('role') === 'button';

                // Priority 1: Aria-label
                if (element.getAttribute('aria-label')) {
                    textToRead = element.getAttribute('aria-label');
                    isClickable = hasClickHandler;
                }
                // Priority 2: Title attribute
                else if (element.getAttribute('title')) {
                    textToRead = element.getAttribute('title');
                    isClickable = hasClickHandler;
                }
                // Priority 3: Specific element types
                else if (element.tagName === 'IMG') {
                    textToRead = element.alt || 'Image';
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'A') {
                    textToRead = `Link: ${element.textContent.trim()}`;
                    isClickable = true;
                }
                else if (element.tagName === 'BUTTON') {
                    // Get text content but exclude material icons
                    let buttonText = '';
                    element.childNodes.forEach(node => {
                        if (node.nodeType === Node.TEXT_NODE) {
                            buttonText += node.textContent.trim() + ' ';
                        } else if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('material-icons')) {
                            buttonText += node.textContent.trim() + ' ';
                        }
                    });
                    buttonText = buttonText.trim();
                    if (buttonText) {
                        textToRead = `Button: ${buttonText}`;
                        isClickable = true;
                    } else {
                        return; // Skip buttons with only icons
                    }
                }
                else if (element.tagName === 'INPUT') {
                    const label = document.querySelector(`label[for="${element.id}"]`);
                    const labelText = label ? label.textContent.trim() : '';
                    const type = element.type || 'text';
                    const value = element.value || '';

                    if (type === 'checkbox' || type === 'radio') {
                        const state = element.checked ? 'checked' : 'unchecked';
                        textToRead = `${labelText || type} ${state}`;
                    } else if (value) {
                        textToRead = `${labelText || 'Input field'}: current value is ${value}`;
                    } else {
                        textToRead = `${labelText || 'Input field'}: ${element.placeholder || 'empty'}`;
                    }
                    isClickable = true;
                }
                else if (element.tagName === 'TEXTAREA') {
                    const label = document.querySelector(`label[for="${element.id}"]`);
                    const value = element.value || '';
                    textToRead = `Text area ${label ? label.textContent : ''}: ${value || element.placeholder || 'empty'}`;
                    isClickable = true;
                }
                else if (element.tagName === 'SELECT') {
                    const label = document.querySelector(`label[for="${element.id}"]`);
                    const selectedOption = element.options[element.selectedIndex];
                    const selectedText = selectedOption ? selectedOption.text : 'nothing selected';
                    textToRead = `Dropdown menu: ${label ? label.textContent.trim() + ', ' : ''}currently selected: ${selectedText}`;
                    isClickable = true;
                }
                else if (element.tagName === 'OPTION') {
                    textToRead = element.textContent.trim();
                    isClickable = false; // Don't add "clickable" prefix
                }
                else if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(element.tagName)) {
                    textToRead = element.textContent.trim();
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'P') {
                    textToRead = element.textContent.trim();
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'LABEL') {
                    const forElement = element.getAttribute('for');
                    const associatedInput = forElement ? document.getElementById(forElement) : null;
                    textToRead = `Label: ${element.textContent.trim()}`;
                    if (associatedInput) {
                        textToRead += `. Associated with ${associatedInput.tagName.toLowerCase()}`;
                    }
                    isClickable = false;
                }
                else if (element.tagName === 'SPAN') {
                    // Check if it's a counter value or price tag
                    if (element.classList.contains('counter-value')) {
                        textToRead = `Count: ${element.textContent.trim()}`;
                    } else if (element.classList.contains('price-tag')) {
                        textToRead = `Price: ${element.textContent.trim()}`;
                    } else {
                        textToRead = element.textContent.trim();
                    }
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'NAV') {
                    textToRead = 'Navigation menu';
                    isClickable = false;
                }
                else if (element.tagName === 'FOOTER') {
                    textToRead = 'Footer section';
                    isClickable = false;
                }
                else if (element.tagName === 'HEADER') {
                    textToRead = 'Header section';
                    isClickable = false;
                }
                else if (element.tagName === 'SECTION') {
                    const heading = element.querySelector('h1, h2, h3, h4, h5, h6');
                    if (heading) {
                        textToRead = `Section: ${heading.textContent.trim()}`;
                    } else {
                        return;
                    }
                    isClickable = hasClickHandler;
                }
                // Enhanced DIV reading
                else if (element.tagName === 'DIV') {
                    // Check for specific interactive components
                    if (element.classList.contains('counter-group')) {
                        const label = element.querySelector('.counter-label');
                        const price = element.querySelector('.counter-price');
                        const count = element.querySelector('.counter-value');
                        if (label && count) {
                            textToRead = `${label.textContent.trim()}: ${count.textContent.trim()} selected. ${price ? price.textContent.trim() : ''}`;
                        }
                        isClickable = true;
                    } else if (element.classList.contains('visit-type-card')) {
                        const title = element.querySelector('h4');
                        const price = element.querySelector('.price-tag');
                        const description = element.querySelector('p:not(.price-tag)');
                        textToRead = `${title ? title.textContent.trim() : 'Visit option'}. ${price ? price.textContent.trim() : ''}. ${description ? description.textContent.trim() : ''}`;
                        isClickable = true;
                    } else if (element.classList.contains('calendar-date')) {
                        const isSelected = element.classList.contains('selected');
                        const isUnavailable = element.classList.contains('unavailable');
                        const dateNum = element.textContent.trim();
                        if (isUnavailable) {
                            textToRead = `Date ${dateNum}: unavailable`;
                        } else if (isSelected) {
                            textToRead = `Date ${dateNum}: currently selected`;
                        } else {
                            textToRead = `Date ${dateNum}: available for booking`;
                        }
                        isClickable = !isUnavailable;
                    } else if (element.classList.contains('form-group')) {
                        const label = element.querySelector('.form-label');
                        const input = element.querySelector('input, select, textarea');
                        if (label) {
                            textToRead = `Form field: ${label.textContent.trim()}`;
                            if (input && input.tagName === 'SELECT') {
                                const selected = input.options[input.selectedIndex];
                                textToRead += `. Currently: ${selected ? selected.text : 'not selected'}`;
                            }
                        }
                        isClickable = false;
                    } else if (element.classList.contains('summary-item')) {
                        textToRead = element.textContent.trim().replace(/\s+/g, ' ');
                    } else if (element.classList.contains('summary-total')) {
                        textToRead = `Total amount: ${element.textContent.trim().replace(/\s+/g, ' ')}`;
                    } else if (element.classList.contains('member-status-card')) {
                        const greeting = element.querySelector('#member-greeting');
                        const desc = element.querySelector('#member-description');
                        const badge = element.querySelector('#member-badge');
                        if (greeting && desc && badge) {
                            textToRead = `${greeting.textContent.trim()}. ${desc.textContent.trim()}. ${badge.textContent.trim()}`;
                        }
                    } else if (hasClickHandler) {
                        const heading = element.querySelector('h1, h2, h3, h4, h5, h6');
                        if (heading) {
                            textToRead = heading.textContent.trim();
                        } else {
                            const firstText = element.textContent.trim().substring(0, 150);
                            textToRead = firstText;
                        }
                        isClickable = true;
                    } else {
                        // Read direct text content only
                        const directText = Array.from(element.childNodes)
                            .filter(node => node.nodeType === Node.TEXT_NODE)
                            .map(node => node.textContent.trim())
                            .filter(text => text.length > 0)
                            .join(' ');

                        if (directText) {
                            textToRead = directText;
                        } else {
                            return;
                        }
                    }
                }
                else {
                    textToRead = Array.from(element.childNodes)
                        .filter(node => node.nodeType === Node.TEXT_NODE)
                        .map(node => node.textContent.trim())
                        .filter(text => text.length > 0)
                        .join(' ');

                    isClickable = hasClickHandler;
                }

                // Clean up the text
                textToRead = textToRead.trim().replace(/\s+/g, ' ');

                // Add clickable indicator if needed
                if (isClickable && textToRead && !textToRead.toLowerCase().includes('button') && !textToRead.toLowerCase().includes('link') && !textToRead.toLowerCase().includes('clickable')) {
                    textToRead = `Clickable: ${textToRead}`;
                }

                // Speak if we have meaningful text
                if (textToRead && textToRead.length > 1) {
                    this.speak(textToRead);
                    this.currentElement = element;
                    this.highlightElement(element);
                }
            }

            highlightElement(element) {
                document.querySelectorAll('.sr-highlight').forEach(el => {
                    el.classList.remove('sr-highlight');
                });

                element.classList.add('sr-highlight');
                setTimeout(() => {
                    element.classList.remove('sr-highlight');
                }, 2000);
            }

            speak(text) {
                if (!text || text.trim().length === 0) return;

                this.stopSpeaking();

                if (typeof responsiveVoice !== 'undefined') {
                    responsiveVoice.speak(text, "US English Female", {
                        rate: this.speed,
                        pitch: 1,
                        volume: 1
                    });
                } else {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = this.speed;
                    utterance.pitch = 1;
                    utterance.volume = 1;
                    window.speechSynthesis.speak(utterance);
                }

                this.isReading = true;
            }

            stopSpeaking() {
                if (typeof responsiveVoice !== 'undefined') {
                    responsiveVoice.cancel();
                } else {
                    window.speechSynthesis.cancel();
                }
                this.isReading = false;
                this.currentElement = null;
            }

            updateSpeedLabel() {
                const label = document.getElementById('speed-value');
                if (this.speed < 0.8) {
                    label.textContent = 'Slow';
                } else if (this.speed > 1.2) {
                    label.textContent = 'Fast';
                } else {
                    label.textContent = 'Normal';
                }
            }

            saveSettings() {
                localStorage.setItem('screenReaderSettings', JSON.stringify({
                    enabled: this.isEnabled,
                    autoHover: this.autoReadOnHover,
                    readClick: this.readOnClick,
                    speed: this.speed
                }));
            }

            loadSettings() {
                const saved = localStorage.getItem('screenReaderSettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    this.isEnabled = settings.enabled || false;
                    this.autoReadOnHover = settings.autoHover || false;
                    this.readOnClick = settings.readClick || false;
                    this.speed = settings.speed || 1.0;

                    const hoverCheckbox = document.getElementById('auto-hover');
                    const clickCheckbox = document.getElementById('read-click');

                    document.getElementById('enable-reader').checked = this.isEnabled;
                    document.getElementById('speed-control').value = this.speed;
                    this.updateSpeedLabel();

                    if (this.isEnabled) {
                        hoverCheckbox.disabled = false;
                        clickCheckbox.disabled = false;
                        hoverCheckbox.checked = this.autoReadOnHover;
                        clickCheckbox.checked = this.readOnClick;

                        this.enableReader();
                        if (this.autoReadOnHover) {
                            this.enableHoverReading();
                        }
                    } else {
                        hoverCheckbox.disabled = true;
                        clickCheckbox.disabled = true;
                        hoverCheckbox.checked = false;
                        clickCheckbox.checked = false;
                    }
                }
            }
        }

        // Initialize screen reader when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.screenReader = new ScreenReaderSystem();

                document.addEventListener('click', (e) => {
                    // Skip material icons
                    if (e.target.classList && e.target.classList.contains('material-icons')) return;

                    if (window.screenReader && window.screenReader.isEnabled && window.screenReader.readOnClick) {
                        window.screenReader.readElement(e.target);
                    }
                });
            });
        } else {
            window.screenReader = new ScreenReaderSystem();

            document.addEventListener('click', (e) => {
                // Skip material icons
                if (e.target.classList && e.target.classList.contains('material-icons')) return;

                if (window.screenReader && window.screenReader.isEnabled && window.screenReader.readOnClick) {
                    window.screenReader.readElement(e.target);
                }
            });
        }
    </script>
    <script src="cache-helper.js"></script>

</body>

</html>