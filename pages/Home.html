<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATHAR Museum - Discover History</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #653025;
            --primary-light: #8d2e1d;
            --accent: #b08d57;
            --accent-light: #d4b483;
            --neutral-light: #f4f1e3;
            --neutral-dark: #4a3c2a;
            --text-dark: #3b2f23;
            --text-light: #7c6f57;
            --white: #fdfaf4;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--neutral-light);
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            line-height: 1.2;
        }

        nav {
            background: var(--white);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1300px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "◈";
            color: var(--accent);
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 80%;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-dark);
        }

        .account-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--white);
            color: var(--primary-dark);
            font-size: 1.2rem;
            border: 2px solid var(--accent);
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }

        .account-icon:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 15px rgba(26, 54, 93, 0.25);
            border-color: var(--accent-light);
        }

        .hero {
            height: 100vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #d9d4be;
            background: url("../images/RedRug.jpg") no-repeat top right;
            background-size: cover;
        }

        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            padding: 2rem;
            animation: fadeIn 1s ease-out;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            letter-spacing: -0.5px;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2.5rem;
            font-weight: 300;
            opacity: 0.9;
        }

        /* Search Bar Styles */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 0.8rem 1.5rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .search-wrapper:focus-within {
            transform: scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 1);
        }

        .search-icon {
            color: var(--accent);
            margin-right: 1rem;
            font-size: 1.5rem;
        }

        #hero-search {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 1.1rem;
            color: var(--text-dark);
            outline: none;
            font-family: 'Inter', sans-serif;
        }

        #hero-search::placeholder {
            color: var(--text-light);
            opacity: 0.7;
        }



        /* Suggestions Dropdown */
        .suggestions-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }

        .suggestions-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .suggestion-category {
            padding: 0.8rem 1.5rem;
            font-weight: 600;
            color: var(--accent);
            background: var(--neutral-light);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-top: 1px solid rgba(176, 141, 87, 0.2);
        }

        .suggestion-category:first-child {
            border-top: none;
            border-radius: 12px 12px 0 0;
        }

        .suggestion-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .suggestion-item:hover {
            background: var(--neutral-light);
            padding-left: 2rem;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-icon {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-title {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 0.2rem;
        }

        .suggestion-meta {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .no-results {
            padding: 2rem;
            text-align: center;
            color: var(--text-light);
        }

        .no-results .material-icons {
            font-size: 3rem;
            opacity: 0.5;
            margin-bottom: 0.5rem;
        }

        .cta-button {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary-dark);
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: var(--transition);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 5rem 2rem;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title h2 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            display: inline-block;
            margin-bottom: 1rem;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: var(--accent);
            margin: 0 auto;
        }

        .section-title .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            margin-top: 0.5rem;
        }

        /* Recommendations Section */
        .recommendations-section {
            background: var(--white);
            padding: 4rem 0;
            margin: 3rem 0;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .recommendations-header {
            text-align: center;
            margin-bottom: 1rem;
        }

        .recommendations-header h2 {
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            color: var(--primary-dark);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .recommendations-header .material-icons {
            font-size: 2.5rem;
            color: var(--accent);
        }

        .personalized-badge {
            display: inline-block;
            background: var(--neutral-light);
            color: var(--accent);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
            border: 2px solid var(--accent);
        }

        .recommendations-subtitle {
            color: var(--text-light);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            text-align: center;
            margin: 1rem 0 2.5rem;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            padding: 0 2rem;
        }

        .recommendation-card {
            background: var(--neutral-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .recommendation-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .recommendation-image.no-image {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1rem;
        }

        .recommendation-image.no-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" opacity="0.1"><rect fill="%23ffffff" width="200" height="200"/><path d="M40,40 C60,20 80,40 100,30 C120,20 140,40 160,30 C180,20 200,40 200,40 L200,200 L40,200 Z" fill="%23d4af37"/></svg>');
            background-size: cover;
        }

        .recommendation-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .badge-trending {
            background: rgba(255, 99, 71, 0.9);
            color: white;
        }

        .badge-interest {
            background: rgba(176, 141, 87, 0.9);
            color: white;
        }

        .badge-popular {
            background: rgba(72, 187, 120, 0.9);
            color: white;
        }

        .badge-country {
            background: rgba(52, 152, 219, 0.9); /* أزرق */
            color: white;
        }

        .badge-gender {
            background: rgba(155, 89, 182, 0.9); /* بنفسجي */
            color: white;
        }

        .badge-ageGroup {
            background: rgba(241, 196, 15, 0.9); /* أصفر */
            color: white;
        }


        .recommendation-content {
            padding: 1.5rem;
        }

        .recommendation-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .recommendation-reason {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .recommendation-description {
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        .loading-recommendations {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-recommendations {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-recommendations .material-icons {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Museum Info */
        .museum-info {
            background: var(--white);
            padding: 5rem 0;
            border-radius: 12px;
            margin: 3rem 0;
            box-shadow: var(--shadow);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
        }

        .info-text h2 {
            color: var(--primary-dark);
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .info-text p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .info-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2.5rem;
        }

        .stat-box {
            background: var(--neutral-light);
            padding: 1.8rem;
            border-radius: 10px;
            text-align: center;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            border-bottom: 3px solid var(--accent);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .stat-box h3 {
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stat-box p {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 0;
        }

        .info-image {
            background: linear-gradient(45deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            height: 450px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .info-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" opacity="0.1"><rect fill="%23ffffff" width="200" height="200"/><path d="M40,40 C60,20 80,40 100,30 C120,20 140,40 160,30 C180,20 200,40 200,40 L200,200 L40,200 Z" fill="%23d4af37"/></svg>');
            background-size: cover;
        }

        .info-image div {
            position: relative;
            z-index: 1;
            padding: 2rem;
        }

        .info-image h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        /* Events and Exhibitions */
        .events-exhibitions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            margin: 5rem 0;
        }

        .section {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: var(--primary-dark);
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: var(--accent);
        }

        .event-item,
        .exhibition-item {
            background: var(--neutral-light);
            padding: 1.8rem;
            margin-bottom: 1.8rem;
            border-radius: 10px;
            transition: var(--transition);
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .event-item:hover,
        .exhibition-item:hover {
            transform: translateX(5px);
            border-left: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            background: var(--white);
        }

        .event-item h3,
        .exhibition-item h3 {
            color: var(--primary-dark);
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
        }

        .event-date {
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            display: block;
        }

        .event-item p,
        .exhibition-item p {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 4rem 0 2rem;
            margin-top: 5rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h3 {
            color: var(--accent-light);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .footer-section p {
            margin-bottom: 0.8rem;
            opacity: 0.9;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 992px) {
            .hero-content h1 {
                font-size: 2.8rem;
            }

            .info-grid {
                gap: 3rem;
            }

            .recommendations-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .search-container {
                max-width: 500px;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero-content h1 {
                font-size: 2.3rem;
            }

            .hero-content p {
                font-size: 1.1rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .events-exhibitions {
                grid-template-columns: 1fr;
                gap: 2.5rem;
            }

            .info-stats {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 2rem;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .search-container {
                max-width: 90%;
            }

            #hero-search {
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .hero-content h1 {
                font-size: 2rem;
            }

            .container {
                padding: 4rem 1.5rem;
            }

            .info-image {
                height: 350px;
            }

            .stat-box {
                padding: 1.5rem;
            }

            .search-wrapper {
                flex-direction: column;
                gap: 0.8rem;
                padding: 1rem;
            }
        }

        /* Notification Badge on Account Icon */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid var(--white);
            animation: pulse 2s infinite;
            z-index: 10;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Highlight animation for searched sections */
        @keyframes highlightPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(176, 141, 87, 0.7);
                background-color: rgba(176, 141, 87, 0.1);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(176, 141, 87, 0);
                background-color: rgba(176, 141, 87, 0.2);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(176, 141, 87, 0);
                background-color: transparent;
            }
        }

        .highlight-section {
            animation: highlightPulse 2s ease-out;
            border: 2px solid var(--accent) !important;
            border-radius: 12px;
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-container">
            <a href="Home.html" class="logo">ATHAR Museum</a>
            <ul class="nav-links">
                <li><a href="Home.html" class="active">Home</a></li>
                <li><a href="AboutUs.html">About Us</a></li>
                <li><a href="Events.html">Events</a></li>
                <li><a href="Ticketing.html">Ticketing</a></li>
                <li><a href="News.html">News</a></li>
                <li><a href="Exhibitions.html">Exhibitions</a></li>
                <li><a href="Gallery.html">Gallery</a></li>
            </ul>
            <a href="Account.html" class="account-icon" title="My Account"><span
                    class="material-icons">person</span></a>
        </div>
    </nav>

    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Discover Timeless ATHAR</h1>
            <p>Experience centuries of art, culture, and history through our world-class collections and immersive
                exhibitions.</p>
            
            <!-- Search Bar replacing CTA button -->
            <div class="search-container">
                <div class="search-wrapper">
                    <span class="material-icons search-icon">search</span>
                    <input 
                        type="text" 
                        id="hero-search" 
                        placeholder="Search exhibitions, events, artworks..."
                        autocomplete="off"
                    >
                </div>
                <div class="suggestions-dropdown" id="suggestions-dropdown"></div>
            </div>
        </div>
    </section>

    <section class="museum-info">
        <div class="container">
            <div class="info-grid">
                <div class="info-text">
                    <h2>About Our Museum</h2>
                    <p>Established in 1892, the ATHAR Museum stands as a beacon of cultural preservation and education.
                        Our mission is to inspire curiosity and understanding of our shared human story through
                        carefully curated collections and engaging programs.</p>
                    <p>With over 50,000 artifacts spanning 5,000 years of human civilization, we offer visitors an
                        unparalleled journey through time. Our expertly designed galleries provide context and meaning
                        to the objects that have shaped our world.</p>
                    <div class="info-stats">
                        <div class="stat-box">
                            <h3>50K+</h3>
                            <p>Artifacts</p>
                        </div>
                        <div class="stat-box">
                            <h3>15</h3>
                            <p>Galleries</p>
                        </div>
                        <div class="stat-box">
                            <h3>500K+</h3>
                            <p>Annual Visitors</p>
                        </div>
                        <div class="stat-box">
                            <h3>130</h3>
                            <p>Years of History</p>
                        </div>
                    </div>
                </div>
                <div class="info-image">
                    <div>
                        <h3>Architectural Marvel</h3>
                        <p>Our beautifully restored building combines historic charm with modern amenities</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Personalized Recommendations -->
    <section class="recommendations-section" id="recommendations-section" style="display: none;">
        <div class="container">
            <div class="recommendations-header">
                <h2>
                    <span class="material-icons">auto_awesome</span>
                    Recommended for You
                </h2>
                <br>
                <span class="personalized-badge">✨ Personalized</span>
            </div>
            <p class="recommendations-subtitle">Based on your interests and preferences</p>

            <div id="recommendations-loading" class="loading-recommendations">
                <span class="material-icons" style="font-size: 3rem; animation: spin 2s linear infinite;">explore</span>
                <p>Finding perfect recommendations for you...</p>
            </div>
            <div id="recommendations-container" class="recommendations-grid" style="display: none;"></div>
            <div id="no-recommendations" class="no-recommendations" style="display: none;">
                <span class="material-icons">explore_off</span>
                <h3>No Recommendations Yet</h3>
                <p>Start exploring our gallery and liking artworks to get personalized recommendations!</p>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="section-title">
            <h2>What's On</h2>
        </div>
        <div class="events-exhibitions">
            <div class="section" id="upcoming-events">
                <h2>Upcoming Events</h2>
                <div id="upcoming-events-container">
                    <div class="loading-spinner" style="padding: 2rem;">
                        <div class="spinner" style="border: 3px solid var(--neutral-light); border-top: 3px solid var(--accent); width: 40px; height: 40px;"></div>
                        <p class="loading-text" style="margin-top: 1rem; color: var(--text-light);">Loading upcoming events...</p>
                    </div>
                </div>
            </div>
            <div class="section" id="featured-exhibitions">
                <h2>Featured Exhibitions</h2>
                <div id="featured-exhibitions-container">
                    <div class="loading-spinner" style="padding: 2rem;">
                        <div class="spinner" style="border: 3px solid var(--neutral-light); border-top: 3px solid var(--accent); width: 40px; height: 40px;"></div>
                        <p class="loading-text" style="margin-top: 1rem; color: var(--text-light);">Loading featured exhibitions...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-section">
                    <h3>Visit Us</h3>
                    <p>123 Museum Boulevard</p>
                    <p>Cultural District</p>
                    <p>City, State 12345</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
                <div class="footer-section">
                    <h3>Hours</h3>
                    <p>Monday - Friday: 9:00 AM - 6:00 PM</p>
                    <p>Saturday - Sunday: 10:00 AM - 8:00 PM</p>
                    <p>Closed on major holidays</p>
                </div>
                <div class="footer-section">
                    <h3>Admission</h3>
                    <p>Adults: $15</p>
                    <p>Students/Seniors: $12</p>
                    <p>Children under 12: Free</p>
                    <p>Members: Always Free</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ATHAR Museum. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Include the highlighter script for search navigation -->
    <script src="section-highlighter.js"></script>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import './notification-system.js';

        let currentUser = null;
        let userData = null;
        let allArtworks = [];
        let allUsers = [];
        let searchData = [];

        // Interest to Category Mapping
        const interestToCategoryMap = {
            'Manuscripts': 'codices',
            'Weapons': 'arms',
            'Boxes': 'boxes',
            'Bottles': 'bottles'
        };

        const interestToExhibitionMap = {
            'Arab Heritage': 'Arab Heritage',
            'Persian Heritage': 'Persian Heritage',
            'Indian Heritage': 'Indian Heritage',
            'Andalusian Heritage': 'Andalusian Heritage',
            'Turkish Heritage': 'Turkish Heritage',
            'Echoes of Islamic Civilization': 'Others'
        };

        // Load Upcoming Events from Database (Top 3)
        async function loadUpcomingEvents() {
            try {
                const eventsCol = collection(db, 'Events');
                const eventsSnapshot = await getDocs(eventsCol);
                
                const now = new Date();
                const upcomingEvents = [];

                eventsSnapshot.forEach(doc => {
                    const data = doc.data();
                    const startDate = data.startDate?.toDate();
                    
                    // Only include events that haven't started yet
                    if (startDate && startDate > now) {
                        upcomingEvents.push({
                            id: doc.id,
                            ...data,
                            startDate: startDate
                        });
                    }
                });

                // Sort by date (earliest first) and take top 3
                upcomingEvents.sort((a, b) => a.startDate - b.startDate);
                const top3Events = upcomingEvents.slice(0, 3);

                displayUpcomingEvents(top3Events);
            } catch (error) {
                console.error('Error loading upcoming events:', error);
                document.getElementById('upcoming-events-container').innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        Unable to load events
                    </p>
                `;
            }
        }

        function displayUpcomingEvents(events) {
            const container = document.getElementById('upcoming-events-container');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        No upcoming events at this time
                    </p>
                `;
                return;
            }

            container.innerHTML = events.map(event => {
                const dateStr = event.startDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="event-item" onclick="navigateToEvent('${event.id}')" style="cursor: pointer;">
                        <span class="event-date">${dateStr}</span>
                        <h3>${event.title || 'Untitled Event'}</h3>
                        <p>${event.description || 'No description available'}</p>
                    </div>
                `;
            }).join('');
        }

        // Navigate to event on Events page
        window.navigateToEvent = function(eventId) {
            // Store event ID to highlight
            sessionStorage.setItem('highlightEvent', eventId);
            window.location.href = 'Events.html#event-' + eventId;
        }

        // Calculate most popular interests from all users
        async function getMostPopularInterests() {
            try {
                const usersCol = collection(db, 'Users');
                const usersSnapshot = await getDocs(usersCol);
                
                const interestCount = {};

                usersSnapshot.forEach(doc => {
                    const data = doc.data();
                    const interests = data.Interests || [];
                    
                    interests.forEach(interest => {
                        interestCount[interest] = (interestCount[interest] || 0) + 1;
                    });
                });

                // Sort interests by count and return top ones
                const sortedInterests = Object.entries(interestCount)
                    .sort((a, b) => b[1] - a[1])
                    .map(entry => entry[0]);

                console.log('Popular interests ranking:', sortedInterests);
                return sortedInterests;
            } catch (error) {
                console.error('Error getting popular interests:', error);
                return [];
            }
        }

        // Load Featured Exhibitions based on most popular interests
        async function loadFeaturedExhibitions() {
            try {
                // Get most popular interests
                const popularInterests = await getMostPopularInterests();

                // Get all artworks
                const artworksCol = collection(db, 'Museum_Collection');
                const artworksSnapshot = await getDocs(artworksCol);
                
                const exhibitionCounts = {};

                // FIRST: Count ALL artworks per exhibition (accurate counts)
                artworksSnapshot.forEach(doc => {
                    const data = doc.data();
                    let exhibition = data.Exhibition;
                    
                    if (!exhibition) return;

                    // Normalize exhibition name (trim spaces, consistent capitalization)
                    exhibition = exhibition.trim();
                    
                    // Map common variations to standard names
                    const exhibitionMap = {
                        'arab heritage': 'Arab Heritage',
                        'persian heritage': 'Persian Heritage',
                        'indian heritage': 'Indian Heritage',
                        'andalusian heritage': 'Andalusian Heritage',
                        'turkish heritage': 'Turkish Heritage',
                        'others': 'Others'
                    };
                    
                    const normalizedKey = exhibition.toLowerCase();
                    const standardName = exhibitionMap[normalizedKey] || exhibition;

                    // Initialize if new exhibition
                    if (!exhibitionCounts[standardName]) {
                        exhibitionCounts[standardName] = {
                            count: 0,
                            popularityScore: 0
                        };
                    }

                    // Count EVERY artwork in this exhibition
                    exhibitionCounts[standardName].count++;
                });

                // SECOND: Add popularity score based on user interests
                Object.keys(exhibitionCounts).forEach(exhibition => {
                    popularInterests.forEach((interest, index) => {
                        const mappedExhibition = interestToExhibitionMap[interest];
                        if (mappedExhibition === exhibition) {
                            // Higher score for more popular interests (diminishing weight)
                            exhibitionCounts[exhibition].popularityScore += (popularInterests.length - index);
                        }
                    });
                });

                // Sort exhibitions by popularity score, then by count
                const sortedExhibitions = Object.entries(exhibitionCounts)
                    .sort((a, b) => {
                        // First sort by popularity score
                        if (b[1].popularityScore !== a[1].popularityScore) {
                            return b[1].popularityScore - a[1].popularityScore;
                        }
                        // Then by artwork count
                        return b[1].count - a[1].count;
                    })
                    .slice(0, 3);

                console.log('Exhibition counts (normalized):', exhibitionCounts);
                console.log('Top 3 featured:', sortedExhibitions);
                
                displayFeaturedExhibitions(sortedExhibitions);
            } catch (error) {
                console.error('Error loading featured exhibitions:', error);
                document.getElementById('featured-exhibitions-container').innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        Unable to load exhibitions
                    </p>
                `;
            }
        }

        function displayFeaturedExhibitions(exhibitions) {
            const container = document.getElementById('featured-exhibitions-container');
            
            if (exhibitions.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        No exhibitions available
                    </p>
                `;
                return;
            }

            container.innerHTML = exhibitions.map(([name, data]) => {
                const artworkCount = data.count;
                const description = getExhibitionDescription(name);

                return `
                    <div class="exhibition-item" onclick="navigateToExhibition('${encodeURIComponent(name)}')" style="cursor: pointer;">
                        <h3>${name}</h3>
                        <span class="event-date">${artworkCount} artwork${artworkCount !== 1 ? 's' : ''}${data.popularityScore > 0 ? ' • Popular Choice' : ''}</span>
                        <p>${description}</p>
                    </div>
                `;
            }).join('');
        }

        // Navigate to exhibition details page
        window.navigateToExhibition = function(exhibitionName) {
            // Navigate to ExhibitionDetails page with exhibition name as parameter
            window.location.href = 'ExhibitionDetails.html?exhibition=' + exhibitionName;
        }

        // Helper function to get exhibition descriptions
        function getExhibitionDescription(exhibitionName) {
            const descriptions = {
                'Arab Heritage': 'Explore the rich cultural treasures of Arab civilization through stunning artifacts and art.',
                'Persian Heritage': 'Discover the art and history of ancient Persia, from intricate textiles to masterful ceramics.',
                'Indian Heritage': 'Journey through thousands of years of Indian civilization and artistic achievement.',
                'Andalusian Heritage': 'Experience the golden age of Andalusian culture and its lasting influence.',
                'Turkish Heritage': 'Discover the treasures of the Ottoman Empire and Turkish artistic traditions.',
                'Others': 'Echoes of Islamic Civilization - A diverse collection spanning the Islamic world.'
            };

            return descriptions[exhibitionName] || 'A remarkable collection showcasing artistic and cultural heritage.';
        }

        // Search Data Structure
        function buildSearchIndex() {
            searchData = [];

            // Add exhibitions - navigate to ExhibitionDetails page
            const exhibitions = [
                { name: 'Arab Heritage', url: 'ExhibitionDetails.html?exhibition=Arab%20Heritage', type: 'exhibition', description: 'Explore Arab cultural treasures' },
                { name: 'Persian Heritage', url: 'ExhibitionDetails.html?exhibition=Persian%20Heritage', type: 'exhibition', description: 'Discover Persian art and history' },
                { name: 'Indian Heritage', url: 'ExhibitionDetails.html?exhibition=Indian%20Heritage', type: 'exhibition', description: 'Journey through Indian civilization' },
                { name: 'Andalusian Heritage', url: 'ExhibitionDetails.html?exhibition=Andalusian%20Heritage', type: 'exhibition', description: 'Experience Andalusian culture' },
                { name: 'Turkish Heritage', url: 'ExhibitionDetails.html?exhibition=Turkish%20Heritage', type: 'exhibition', description: 'Discover Ottoman treasures' },
                { name: 'Others', url: 'ExhibitionDetails.html?exhibition=Others', type: 'exhibition', description: 'Echoes of Islamic Civilization' }
            ];

            // Add events with section targeting
            const events = [
                { name: 'Ancient Egypt Night Tour', url: 'Home.html#upcoming-events', type: 'event', date: 'October 25, 2025', description: 'After-hours guided tour', section: 'upcoming-events' },
                { name: 'Renaissance Art Workshop', url: 'Home.html#upcoming-events', type: 'event', date: 'November 12, 2025', description: 'Learn painting techniques', section: 'upcoming-events' },
                { name: 'Family Discovery Day', url: 'Home.html#upcoming-events', type: 'event', date: 'November 28, 2025', description: 'Interactive family event', section: 'upcoming-events' }
            ];

            // Add pages
            const pages = [
                { name: 'Gallery', url: 'Gallery.html', type: 'page', description: 'Browse our complete art collection' },
                { name: 'Events', url: 'Events.html', type: 'page', description: 'View upcoming museum events' },
                { name: 'News', url: 'News.html', type: 'page', description: 'Latest museum news and updates' },
                { name: 'About Us', url: 'AboutUs.html', type: 'page', description: 'Learn about our museum' },
                { name: 'Ticketing', url: 'Ticketing.html', type: 'page', description: 'Purchase museum tickets' },
                { name: 'Account', url: 'Account.html', type: 'page', description: 'Manage your account' }
            ];

            searchData = [...exhibitions, ...events, ...pages];

            // Add artworks from database
            allArtworks.forEach(artwork => {
                searchData.push({
                    name: artwork.title || 'Untitled',
                    url: `ArtDetails.html?id=${artwork.id}`,
                    type: 'artwork',
                    description: `${artwork.artist || artwork.artistName || 'Unknown Artist'} • ${artwork.Exhibition || 'Museum Collection'}`,
                    keywords: [
                        artwork.title,
                        artwork.artist,
                        artwork.artistName,
                        artwork.Exhibition,
                        artwork.classification
                    ].filter(Boolean).join(' ').toLowerCase()
                });
            });
        }

        // Search functionality
        function performSearch(query) {
            if (!query || query.trim().length < 2) {
                return [];
            }

            const lowerQuery = query.toLowerCase().trim();
            const results = [];

            searchData.forEach(item => {
                const searchText = `${item.name} ${item.description} ${item.keywords || ''}`.toLowerCase();
                
                if (searchText.includes(lowerQuery)) {
                    // Calculate relevance score
                    let score = 0;
                    if (item.name.toLowerCase().startsWith(lowerQuery)) {
                        score = 100; // Exact match at start
                    } else if (item.name.toLowerCase().includes(lowerQuery)) {
                        score = 50; // Contains in name
                    } else {
                        score = 10; // Contains in description/keywords
                    }

                    results.push({ ...item, score });
                }
            });

            // Sort by relevance and limit results
            return results
                .sort((a, b) => b.score - a.score)
                .slice(0, 8);
        }

        // Display search suggestions
        function displaySuggestions(results) {
            const dropdown = document.getElementById('suggestions-dropdown');
            
            if (results.length === 0) {
                dropdown.innerHTML = `
                    <div class="no-results">
                        <span class="material-icons">search_off</span>
                        <p>No results found</p>
                    </div>
                `;
                dropdown.classList.add('show');
                return;
            }

            // Group results by type
            const grouped = {
                exhibition: [],
                event: [],
                artwork: [],
                page: []
            };

            results.forEach(result => {
                grouped[result.type].push(result);
            });

            let html = '';

            // Display each category
            if (grouped.exhibition.length > 0) {
                html += '<div class="suggestion-category">Exhibitions</div>';
                grouped.exhibition.forEach(item => {
                    html += createSuggestionHTML(item, 'museum');
                });
            }

            if (grouped.event.length > 0) {
                html += '<div class="suggestion-category">Events</div>';
                grouped.event.forEach(item => {
                    html += createSuggestionHTML(item, 'event');
                });
            }

            if (grouped.artwork.length > 0) {
                html += '<div class="suggestion-category">Artworks</div>';
                grouped.artwork.forEach(item => {
                    html += createSuggestionHTML(item, 'palette');
                });
            }

            if (grouped.page.length > 0) {
                html += '<div class="suggestion-category">Pages</div>';
                grouped.page.forEach(item => {
                    html += createSuggestionHTML(item, 'article');
                });
            }

            dropdown.innerHTML = html;
            dropdown.classList.add('show');

            // Add click handlers - direct navigation
            dropdown.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function() {
                    const url = this.dataset.url;
                    window.location.href = url;
                });
            });
        }

        function createSuggestionHTML(item, icon) {
            return `
                <div class="suggestion-item" data-url="${item.url}">
                    <span class="material-icons suggestion-icon">${icon}</span>
                    <div class="suggestion-content">
                        <div class="suggestion-title">${item.name}</div>
                        <div class="suggestion-meta">${item.description}${item.date ? ' • ' + item.date : ''}</div>
                    </div>
                </div>
            `;
        }

        // Search input handler
        const searchInput = document.getElementById('hero-search');
        const dropdown = document.getElementById('suggestions-dropdown');

        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value;

            if (query.trim().length < 2) {
                dropdown.classList.remove('show');
                return;
            }

            searchTimeout = setTimeout(() => {
                const results = performSearch(query);
                displaySuggestions(results);
            }, 300);
        });

        // Enter key - do nothing, user must click a suggestion
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); // Prevent form submission
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                dropdown.classList.remove('show');
            }
        });

        function calculateAge(dateOfBirth) {
            if (!dateOfBirth) return null;
            const birthDate = dateOfBirth.toDate ? dateOfBirth.toDate() : new Date(dateOfBirth);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        function getAgeGroup(age) {
            if (age < 13) return 'child';
            if (age <= 25) return 'youth';
            if (age <= 59) return 'adult';
            return 'senior';
        }

        async function loadData() {
            try {
                const [artworksSnap, usersSnap] = await Promise.all([
                    getDocs(collection(db, "Museum_Collection")),
                    getDocs(collection(db, "Users"))
                ]);

                allArtworks = artworksSnap.docs.map(doc => {
                    const data = doc.data();
                    let cleanImageURL = (data.imageURL || data.ImageURL || '').trim();
                    cleanImageURL = cleanImageURL.replace(/\n/g, '').replace(/\r/g, '');

                    return {
                        id: doc.id,
                        ...data,
                        imageURL: cleanImageURL
                    };
                });

                allUsers = usersSnap.docs.map(doc => {
                    const data = doc.data();
                    const age = calculateAge(data['Date of Birth']);
                    return {
                        id: doc.id,
                        ...data,
                        age: age,
                        ageGroup: age ? getAgeGroup(age) : 'unknown'
                    };
                });

                // Build search index after loading data
                buildSearchIndex();

                console.log('Loaded artworks:', allArtworks.length);
                console.log('Search index built with', searchData.length, 'items');
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function generateRecommendations() {
    if (!userData || allArtworks.length === 0) {
        return [];
    }

    const userInterests = userData.Interests || [];
    const userAge = calculateAge(userData['Date of Birth']);
    const userAgeGroup = userAge ? getAgeGroup(userAge) : null;
    const userCountry = userData.Country || null;
    const userGender = userData.Gender || null;
    const userLikedArtworks = userData.likedArtworks || [];

    // حساب الحد الديناميكي
    const totalUsers = allUsers.length;
    const minThreshold = totalUsers < 10 ? 1 : 2;
    const trendingThreshold = totalUsers < 10 ? 3 : 5;

    // فلترة الأعمال المعجب بها مسبقاً
    const availableArtworks = allArtworks.filter(art => !userLikedArtworks.includes(art.id));

    const selectedArtworks = new Map(); // لتجنب التكرار
    const recommendations = [];

    

                    // ========== 1. الأكثر شهرة عموماً (Trending) ==========
            const trendingArtwork = availableArtworks
                .filter(art => art.likesCount >= trendingThreshold)
                .sort((a, b) => (b.likesCount || 0) - (a.likesCount || 0))[0];

            if (trendingArtwork) {
                selectedArtworks.set(trendingArtwork.id, {
                    ...trendingArtwork,
                    reasons: ['🔥 Most popular artwork overall'],
                    category: 'trending'
                });
            }

            // ========== 2. الأكثر شهرة في الدولة ==========
            if (userCountry) {
                const countryPopular = availableArtworks
                    .map(art => {
                        const countryLikes = (art.likedBy || []).filter(userId => {
                            const user = allUsers.find(u => u.uid === userId);
                            return user && user.Country === userCountry;
                        }).length;
                        return { ...art, countryLikes };
                    })
                    .filter(art => art.countryLikes >= minThreshold && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.countryLikes - a.countryLikes)[0];

                if (countryPopular) {
                    const existing = selectedArtworks.get(countryPopular.id);
                    if (existing) {
                        existing.reasons.push(`⭐ Most popular in ${userCountry}`);
                    } else {
                        selectedArtworks.set(countryPopular.id, {
                            ...countryPopular,
                            reasons: [`⭐ Most popular in ${userCountry}`],
                            category: 'country'
                        });
                    }
                }
            }

            // ========== 3. الأكثر شهرة عند الجنس ==========
            if (userGender) {
                const genderPopular = availableArtworks
                    .map(art => {
                        const genderLikes = (art.likedBy || []).filter(userId => {
                            const user = allUsers.find(u => u.uid === userId);
                            return user && user.Gender === userGender;
                        }).length;
                        return { ...art, genderLikes };
                    })
                    .filter(art => art.genderLikes >= minThreshold && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.genderLikes - a.genderLikes)[0];

                if (genderPopular) {
                    const existing = selectedArtworks.get(genderPopular.id);
                    const genderText = userGender === 'Female' ? 'women' : 'men';
                    if (existing) {
                        existing.reasons.push(`👥 Most popular among ${genderText}`);
                    } else {
                        selectedArtworks.set(genderPopular.id, {
                            ...genderPopular,
                            reasons: [`👥 Most popular among ${genderText}`],
                            category: 'gender'
                        });
                    }
                }
            }

            // ========== 4. الأكثر شهرة في الفئة العمرية ==========
            if (userAgeGroup) {
                const ageGroupPopular = availableArtworks
                    .map(art => {
                        const ageGroupLikes = (art.likedBy || []).filter(userId => {
                            const user = allUsers.find(u => u.uid === userId);
                            return user && user.ageGroup === userAgeGroup;
                        }).length;
                        return { ...art, ageGroupLikes };
                    })
                    .filter(art => art.ageGroupLikes >= minThreshold && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.ageGroupLikes - a.ageGroupLikes)[0];

                if (ageGroupPopular) {
                    const existing = selectedArtworks.get(ageGroupPopular.id);
                    const ageGroupText = {
                        'child': 'children',
                        'youth': 'youth',
                        'adult': 'adults',
                        'senior': 'seniors'
                    }[userAgeGroup] || 'your age group';

                    if (existing) {
                        existing.reasons.push(`🎯 Most popular among ${ageGroupText}`);
                    } else {
                        selectedArtworks.set(ageGroupPopular.id, {
                            ...ageGroupPopular,
                            reasons: [`🎯 Most popular among ${ageGroupText}`],
                            category: 'ageGroup'
                        });
                    }
                }
            }

            // ========== 5. الباقي من الاهتمامات ==========
            if (userInterests.length > 0) {
                const interestArtworks = availableArtworks
                    .map(art => {
                        let interestScore = 0;
                        let interestReasons = [];

                        userInterests.forEach(interest => {
                            if (interestToExhibitionMap[interest] && art.Exhibition === interestToExhibitionMap[interest]) {
                                interestScore += 3;
                                interestReasons.push(`✨ From ${interest} exhibition`);
                            }
                            if (interestToCategoryMap[interest] && art.classification === interestToCategoryMap[interest]) {
                                interestScore += 3;
                                interestReasons.push(`✨ Matches your interest in ${interest}`);
                            }
                        });

                        return { ...art, interestScore, interestReasons };
                    })
                    .filter(art => art.interestScore > 0 && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.interestScore - a.interestScore);

                // إضافة الأعمال من الاهتمامات حتى نصل إلى 6
                interestArtworks.forEach(art => {
                    if (selectedArtworks.size < 6) {
                        const existing = selectedArtworks.get(art.id);
                        if (existing) {
                            existing.reasons.push(...art.interestReasons);
                        } else {
                            selectedArtworks.set(art.id, {
                                ...art,
                                reasons: art.interestReasons,
                                category: 'interest'
                            });
                        }
                    }
                });
            }

            // ========== 6. إذا لم نصل إلى 6، نملأ بالأعمال الأكثر شهرة ==========
            if (selectedArtworks.size < 6) {
                const remainingArtworks = availableArtworks
                    .filter(art => !selectedArtworks.has(art.id))
                    .sort((a, b) => (b.likesCount || 0) - (a.likesCount || 0))
                    .slice(0, 6 - selectedArtworks.size);

                remainingArtworks.forEach(art => {
                    selectedArtworks.set(art.id, {
                        ...art,
                        reasons: ['⭐ Popular choice'],
                        category: 'general'
                    });
                });
            }

            // تحويل Map إلى Array
            selectedArtworks.forEach(artwork => {
                recommendations.push(artwork);
            });

            return recommendations.slice(0, 6);
        }
        

       function getBadgeType(rec) {
            switch (rec.category) {
                case 'trending':
                    return 'trending';
                case 'interest':
                    return 'interest';
                case 'country':
                    return 'country';
                case 'gender':
                    return 'gender';
                case 'ageGroup':
                    return 'ageGroup';
                case 'general':
                default:
                    return 'popular';
            }
        }



        function displayRecommendations(recommendations) {
            const loading = document.getElementById('recommendations-loading');
            const container = document.getElementById('recommendations-container');
            const noRecs = document.getElementById('no-recommendations');
            const section = document.getElementById('recommendations-section');

            loading.style.display = 'none';

            if (recommendations.length === 0) {
                noRecs.style.display = 'block';
                section.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            section.style.display = 'block';

            container.innerHTML = recommendations.map(rec => {
                const badgeType = getBadgeType(rec);
                let badgeText = '';

            switch (badgeType) {
                case 'trending':
                    badgeText = '🔥 Trending';
                    break;
                case 'interest':
                    badgeText = '✨ For You';
                    break;
                case 'country':
                    badgeText = '🌍 Top by Country';
                    break;
                case 'gender':
                    badgeText = '👥 Top by Gender';
                    break;
                case 'ageGroup':
                    badgeText = '🎯 Top by Age';
                    break;
                default:
                    badgeText = '⭐ Popular';
            }


                const imageURL = rec.imageURL || '';
                const hasImage = imageURL && imageURL.trim() !== '';

                let imageHTML = '';
                if (hasImage) {
                    imageHTML = `
                        <div class="recommendation-image" style="background-image: url('${imageURL}'); background-size: cover; background-position: center;">
                            <span class="recommendation-badge badge-${badgeType}">${badgeText}</span>
                        </div>
                    `;
                } else {
                    imageHTML = `
                        <div class="recommendation-image no-image">
                            <div style="position: relative; z-index: 1;">🎨 No Image</div>
                            <span class="recommendation-badge badge-${badgeType}">${badgeText}</span>
                        </div>
                    `;
                }

                return `
                    <div class="recommendation-card" onclick="window.location.href='ArtDetails.html?id=${rec.id}'">
                        ${imageHTML}
                        <div class="recommendation-content">
                            <h3 class="recommendation-title">${rec.title || 'Untitled'}</h3>
                            <p class="recommendation-reason">
                                <span class="material-icons" style="font-size: 1rem;">info</span>
                                ${rec.reasons[0]}
                            </p>
                            <p class="recommendation-description">
                                ${rec.artist || rec.artistName || 'Unknown Artist'} • ${rec.Exhibition || 'Museum Collection'}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        onAuthStateChanged(auth, async (user) => {
    if (user) {
        currentUser = user;
        try {
            const userDoc = await getDoc(doc(db, "Users", user.uid));
            if (userDoc.exists()) {
                userData = userDoc.data();
                
                // 🆕 تأكدي من وجود الجنس
                console.log('User Gender:', userData.Gender);
                
                await loadData();

                setTimeout(() => {
                    const recommendations = generateRecommendations();
                    displayRecommendations(recommendations);
                }, 500);
            }
        } catch (error) {
            console.error('Error loading user data:', error);
            document.getElementById('recommendations-section').style.display = 'none';
        }
    } else {
        await loadData();
        document.getElementById('recommendations-section').style.display = 'none';
    }

    loadUpcomingEvents();
    loadFeaturedExhibitions();
});

        // Navigation scroll effect
        window.addEventListener('scroll', function () {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) {
                nav.style.padding = '0.7rem 0';
                nav.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.1)';
            } else {
                nav.style.padding = '1rem 0';
                nav.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.07)';
            }
        });

        // Set active navigation link
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-links a');

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });

            if (currentPage === '' || currentPage === 'index.html' || currentPage === 'Home.html') {
                const homeLink = document.querySelector('a[href="Home.html"]');
                if (homeLink) {
                    homeLink.classList.add('active');
                }
            }
        });

        // Animation for elements on scroll
        function animateOnScroll() {
            const items = document.querySelectorAll('.event-item, .exhibition-item, .stat-box');
            items.forEach(item => {
                const itemTop = item.getBoundingClientRect().top;
                const itemVisible = 150;

                if (itemTop < window.innerHeight - itemVisible) {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const items = document.querySelectorAll('.event-item, .exhibition-item, .stat-box');
            items.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                item.style.transition = 'all 0.6s ease';
            });

            setTimeout(animateOnScroll, 100);
        });

        window.addEventListener('scroll', animateOnScroll);

        // Check for section to highlight on page load
        document.addEventListener('DOMContentLoaded', function() {
            const sectionToHighlight = sessionStorage.getItem('highlightSection');
            
            if (sectionToHighlight) {
                // Clear the storage
                sessionStorage.removeItem('highlightSection');
                
                // Wait a bit for page to fully render
                setTimeout(() => {
                    const targetElement = document.getElementById(sectionToHighlight);
                    
                    if (targetElement) {
                        // Scroll to the element with smooth behavior
                        targetElement.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                        
                        // Add highlight class
                        targetElement.classList.add('highlight-section');
                        
                        // Remove highlight after animation completes
                        setTimeout(() => {
                            targetElement.classList.remove('highlight-section');
                        }, 2000);
                    }
                }, 500);
            }
        });

        // Add spin animation for loading icon
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>