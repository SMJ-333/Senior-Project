<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATHAR Museum - Discover History</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_API_KEY"></script>
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'ar,en',
                autoDisplay: false
            }, 'google_translate_element');
        }

        // Load saved language preference or default to English
        var currentLang = localStorage.getItem('siteLanguage') || 'en';
        var isTranslating = false; // Prevent multiple clicks during translation

        function translateToArabic() {
            // Prevent multiple clicks while translating
            if (isTranslating) {
                console.log('Translation in progress, please wait...');
                return;
            }

            var translateText = document.querySelector('.translate-text');
            var selectElement = document.querySelector('.goog-te-combo');

            if (!selectElement) {
                setTimeout(translateToArabic, 300);
                return;
            }

            isTranslating = true;

            if (currentLang === 'en') {
                // Switch to Arabic
                selectElement.value = 'ar';
                selectElement.dispatchEvent(new Event('change'));

                // Update button text and keep updating it to prevent translation
                function updateButtonToEnglish() {
                    if (translateText) translateText.textContent = 'English';
                }
                updateButtonToEnglish();

                setTimeout(function () {
                    document.documentElement.setAttribute('dir', 'rtl');
                    document.body.setAttribute('dir', 'rtl');
                    document.documentElement.setAttribute('lang', 'ar');

                    // Keep forcing button text
                    updateButtonToEnglish();

                    // Save preference
                    currentLang = 'ar';
                    localStorage.setItem('siteLanguage', 'ar');

                    isTranslating = false;
                }, 1500);

                // Force button text multiple times to override Google Translate
                setTimeout(updateButtonToEnglish, 500);
                setTimeout(updateButtonToEnglish, 1000);
                setTimeout(updateButtonToEnglish, 2000);

            } else {
                // Switch back to English
                selectElement.value = 'en';
                selectElement.dispatchEvent(new Event('change'));

                // Update button text and keep updating it
                function updateButtonToArabic() {
                    if (translateText) translateText.textContent = 'العربية';
                }
                updateButtonToArabic();

                setTimeout(function () {
                    document.documentElement.setAttribute('dir', 'ltr');
                    document.body.setAttribute('dir', 'ltr');
                    document.documentElement.setAttribute('lang', 'en');

                    // Keep forcing button text
                    updateButtonToArabic();

                    // Save preference
                    currentLang = 'en';
                    localStorage.setItem('siteLanguage', 'en');

                    isTranslating = false;
                }, 1500);

                // Force button text multiple times
                setTimeout(updateButtonToArabic, 500);
                setTimeout(updateButtonToArabic, 1000);
                setTimeout(updateButtonToArabic, 2000);
            }
        }

        // Apply saved language preference on page load
        window.addEventListener('load', function () {
            // Mark material icons as not translatable
            var materialIcons = document.querySelectorAll('.material-icons');
            materialIcons.forEach(function (icon) {
                icon.classList.add('notranslate');
            });

            // Wait for Google Translate to initialize
            setTimeout(function () {
                var savedLang = localStorage.getItem('siteLanguage');
                var translateText = document.querySelector('.translate-text');

                if (savedLang === 'ar') {
                    // Apply Arabic if it was previously selected
                    var selectElement = document.querySelector('.goog-te-combo');
                    if (selectElement) {
                        selectElement.value = 'ar';
                        selectElement.dispatchEvent(new Event('change'));

                        // Force button text to English
                        function setEnglish() {
                            if (translateText) translateText.textContent = 'English';
                        }
                        setEnglish();
                        setTimeout(setEnglish, 500);
                        setTimeout(setEnglish, 1000);
                        setTimeout(setEnglish, 2000);

                        setTimeout(function () {
                            document.documentElement.setAttribute('dir', 'rtl');
                            document.body.setAttribute('dir', 'rtl');
                            document.documentElement.setAttribute('lang', 'ar');
                        }, 1500);
                    }
                } else {
                    // Ensure English state
                    function setArabic() {
                        if (translateText) translateText.textContent = 'العربية';
                    }
                    setArabic();
                    setTimeout(setArabic, 500);
                    setTimeout(setArabic, 1000);

                    document.documentElement.setAttribute('dir', 'ltr');
                    document.body.setAttribute('dir', 'ltr');
                    document.documentElement.setAttribute('lang', 'en');
                }
            }, 1000);
        });

        // Keep the button text correct even after page is fully translated
        setInterval(function () {
            var translateText = document.querySelector('.translate-text');
            if (translateText) {
                if (currentLang === 'ar') {
                    if (translateText.textContent !== 'English') {
                        translateText.textContent = 'English';
                    }
                } else {
                    if (translateText.textContent !== 'العربية') {
                        translateText.textContent = 'العربية';
                    }
                }
            }
        }, 2000); // Check every 2 seconds
    </script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <style>
        .goog-te-banner-frame.skiptranslate {
            display: none !important;
        }

        body {
            top: 0px !important;
            position: static !important;
        }

        .goog-te-balloon-frame {
            display: none !important;
        }

        .goog-tooltip {
            display: none !important;
        }

        .goog-tooltip:hover {
            display: none !important;
        }

        .goog-text-highlight {
            background-color: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }

        /* Force remove the top frame */
        #goog-gt-tt {
            display: none !important;
        }

        .goog-te-banner-frame {
            display: none !important;
        }

        /* Remove the "Translated to" bar */
        .goog-te-banner-frame.skiptranslate,
        .goog-te-gadget-simple {
            display: none !important;
        }

        iframe.goog-te-banner-frame {
            display: none !important;
        }

        /* Prevent body from being pushed down */
        body>.skiptranslate {
            display: none !important;
        }

        iframe.skiptranslate {
            display: none !important;
        }

        /* Hide all Google Translate UI elements */
        .VIpgJd-ZVi9od-aZ2wEe-wOHMyf {
            display: none !important;
        }

        .VIpgJd-ZVi9od-aZ2wEe-OiiCO {
            display: none !important;
        }

        .VIpgJd-ZVi9od-xl07Ob-lTBxed {
            display: none !important;
        }

        :root {
            --primary-dark: #653025;
            --primary-light: #8d2e1d;
            --accent: #b08d57;
            --accent-light: #d4b483;
            --neutral-light: #f4f1e3;
            --neutral-dark: #4a3c2a;
            --text-dark: #3b2f23;
            --text-light: #7c6f57;
            --white: #fdfaf4;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--neutral-light);
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            line-height: 1.2;
        }

        nav {
            background: var(--white);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1300px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "◈";
            color: var(--accent);
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 80%;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-dark);
        }

        .account-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--white);
            color: var(--primary-dark);
            font-size: 1.2rem;
            border: 2px solid var(--accent);
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }

        .account-icon:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 15px rgba(26, 54, 93, 0.25);
            border-color: var(--accent-light);
        }

        .hero {
            height: 100vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #d9d4be;
            background: url("../images/RedRug.jpg") no-repeat top right;
            background-size: cover;
        }

        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            padding: 2rem;
            animation: fadeIn 1s ease-out;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            letter-spacing: -0.5px;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2.5rem;
            font-weight: 300;
            opacity: 0.9;
        }

        /* Search Bar Styles */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 0.8rem 1.5rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .search-wrapper:focus-within {
            transform: scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 1);
        }

        .search-icon {
            color: var(--accent);
            margin-right: 1rem;
            font-size: 1.5rem;
        }

        #hero-search {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 1.1rem;
            color: var(--text-dark);
            outline: none;
            font-family: 'Inter', sans-serif;
        }

        #hero-search::placeholder {
            color: var(--text-light);
            opacity: 0.7;
        }



        /* Suggestions Dropdown */
        .suggestions-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }

        .suggestions-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .suggestion-category {
            padding: 0.8rem 1.5rem;
            font-weight: 600;
            color: var(--accent);
            background: var(--neutral-light);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-top: 1px solid rgba(176, 141, 87, 0.2);
        }

        .suggestion-category:first-child {
            border-top: none;
            border-radius: 12px 12px 0 0;
        }

        .suggestion-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .suggestion-item:hover {
            background: var(--neutral-light);
            padding-left: 2rem;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-icon {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-title {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 0.2rem;
        }

        .suggestion-meta {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .no-results {
            padding: 2rem;
            text-align: center;
            color: var(--text-light);
        }

        .no-results .material-icons {
            font-size: 3rem;
            opacity: 0.5;
            margin-bottom: 0.5rem;
        }

        .cta-button {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary-dark);
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: var(--transition);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 5rem 2rem;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title h2 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            display: inline-block;
            margin-bottom: 1rem;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: var(--accent);
            margin: 0 auto;
        }

        .section-title .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            margin-top: 0.5rem;
        }

        /* Recommendations Section */
        .recommendations-section {
            background: var(--white);
            padding: 4rem 0;
            margin: 3rem 0;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .recommendations-header {
            text-align: center;
            margin-bottom: 1rem;
        }

        .recommendations-header h2 {
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            color: var(--primary-dark);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .recommendations-header .material-icons {
            font-size: 2.5rem;
            color: var(--accent);
        }

        .personalized-badge {
            display: inline-block;
            background: var(--neutral-light);
            color: var(--accent);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
            border: 2px solid var(--accent);
        }

        .recommendations-subtitle {
            color: var(--text-light);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            text-align: center;
            margin: 1rem 0 2.5rem;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            padding: 0 2rem;
        }

        .recommendation-card {
            background: var(--neutral-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .recommendation-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .recommendation-image.no-image {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1rem;
        }

        .recommendation-image.no-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" opacity="0.1"><rect fill="%23ffffff" width="200" height="200"/><path d="M40,40 C60,20 80,40 100,30 C120,20 140,40 160,30 C180,20 200,40 200,40 L200,200 L40,200 Z" fill="%23d4af37"/></svg>');
            background-size: cover;
        }

        .recommendation-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .badge-trending {
            background: rgba(255, 99, 71, 0.9);
            color: white;
        }

        .badge-interest {
            background: rgba(176, 141, 87, 0.9);
            color: white;
        }

        .badge-popular {
            background: rgba(72, 187, 120, 0.9);
            color: white;
        }

        .badge-country {
            background: rgba(52, 152, 219, 0.9);
            /* أزرق */
            color: white;
        }

        .badge-gender {
            background: rgba(155, 89, 182, 0.9);
            /* بنفسجي */
            color: white;
        }

        .badge-ageGroup {
            background: rgba(241, 196, 15, 0.9);
            /* أصفر */
            color: white;
        }


        .recommendation-content {
            padding: 1.5rem;
        }

        .recommendation-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .recommendation-reason {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .recommendation-description {
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        .loading-recommendations {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-recommendations {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-recommendations .material-icons {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Museum Info */
        .museum-info {
            background: var(--white);
            padding: 5rem 0;
            border-radius: 12px;
            margin: 3rem 0;
            box-shadow: var(--shadow);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
        }

        .info-text h2 {
            color: var(--primary-dark);
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .info-text p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .info-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2.5rem;
        }

        .stat-box {
            background: var(--neutral-light);
            padding: 1.8rem;
            border-radius: 10px;
            text-align: center;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            border-bottom: 3px solid var(--accent);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .stat-box h3 {
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stat-box p {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 0;
        }

        .info-image {
            background: linear-gradient(45deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            height: 450px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .info-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" opacity="0.1"><rect fill="%23ffffff" width="200" height="200"/><path d="M40,40 C60,20 80,40 100,30 C120,20 140,40 160,30 C180,20 200,40 200,40 L200,200 L40,200 Z" fill="%23d4af37"/></svg>');
            background-size: cover;
        }

        .info-image div {
            position: relative;
            z-index: 1;
            padding: 2rem;
        }

        .info-image h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        /* Events and Exhibitions */
        .events-exhibitions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            margin: 5rem 0;
        }

        .section {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: var(--primary-dark);
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: var(--accent);
        }

        .event-item,
        .exhibition-item {
            background: var(--neutral-light);
            padding: 1.8rem;
            margin-bottom: 1.8rem;
            border-radius: 10px;
            transition: var(--transition);
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .event-item:hover,
        .exhibition-item:hover {
            transform: translateX(5px);
            border-left: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            background: var(--white);
        }

        .event-item h3,
        .exhibition-item h3 {
            color: var(--primary-dark);
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
        }

        .event-date {
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            display: block;
        }

        .event-item p,
        .exhibition-item p {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 4rem 0 2rem;
            margin-top: 5rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h3 {
            color: var(--accent-light);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .footer-section p {
            margin-bottom: 0.8rem;
            opacity: 0.9;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 992px) {
            .hero-content h1 {
                font-size: 2.8rem;
            }

            .info-grid {
                gap: 3rem;
            }

            .recommendations-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .search-container {
                max-width: 500px;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero-content h1 {
                font-size: 2.3rem;
            }

            .hero-content p {
                font-size: 1.1rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .events-exhibitions {
                grid-template-columns: 1fr;
                gap: 2.5rem;
            }

            .info-stats {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 2rem;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .search-container {
                max-width: 90%;
            }

            #hero-search {
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .hero-content h1 {
                font-size: 2rem;
            }

            .container {
                padding: 4rem 1.5rem;
            }

            .info-image {
                height: 350px;
            }

            .stat-box {
                padding: 1.5rem;
            }

            .search-wrapper {
                flex-direction: column;
                gap: 0.8rem;
                padding: 1rem;
            }
        }

        /* Notification Badge on Account Icon */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid var(--white);
            animation: pulse 2s infinite;
            z-index: 10;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Highlight animation for searched sections */
        @keyframes highlightPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(176, 141, 87, 0.7);
                background-color: rgba(176, 141, 87, 0.1);
            }

            50% {
                box-shadow: 0 0 0 20px rgba(176, 141, 87, 0);
                background-color: rgba(176, 141, 87, 0.2);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(176, 141, 87, 0);
                background-color: transparent;
            }
        }

        .highlight-section {
            animation: highlightPulse 2s ease-out;
            border: 2px solid var(--accent) !important;
            border-radius: 12px;
        }

        .accessibility-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .accessibility-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-dark);
            color: var(--white);
            border: 3px solid var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .accessibility-btn:hover {
            transform: scale(1.1);
            background: var(--primary-light);
        }

        .accessibility-btn.active {
            background: var(--accent);
            color: var(--primary-dark);
        }

        .accessibility-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            min-width: 250px;
            display: none;
        }

        .accessibility-menu.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .accessibility-menu h3 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .menu-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--neutral-light);
            transition: var(--transition);
        }

        .menu-option:last-child {
            border-bottom: none;
        }

        .menu-option label {
            color: var(--text-dark);
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-option:has(input:disabled) {
            opacity: 0.5;
        }

        .menu-option:has(input:disabled) label {
            cursor: not-allowed;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        .toggle-switch input:disabled+.slider {
            background-color: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .toggle-switch input:disabled+.slider:before {
            background-color: #f5f5f5;
        }

        .speed-control {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.8rem 0;
        }

        .speed-control input[type="range"] {
            width: 100%;
            accent-color: var(--accent);
        }

        .speed-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .sr-highlight {
            outline: 3px solid var(--accent) !important;
            outline-offset: 2px;
            background-color: rgba(176, 141, 87, 0.1) !important;
        }

        @media (max-width: 768px) {
            .accessibility-controls {
                bottom: 15px;
                right: 15px;
            }

            .accessibility-btn {
                width: 55px;
                height: 55px;
            }

            .accessibility-menu {
                right: -10px;
                min-width: 220px;
            }
        }

        /* Language Toggle Button */
        .language-toggle {
            background: var(--accent);
            color: var(--primary-dark);
            border: 2px solid var(--accent);
            padding: 0.5rem 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
        }

        .language-toggle:hover {
            background: var(--accent-light);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(176, 141, 87, 0.3);
        }

        .language-toggle .material-icons {
            font-size: 1.2rem;
        }

        /* RTL Support for Arabic */
        body[dir="rtl"] {
            direction: rtl;
            text-align: right;
        }

        body[dir="rtl"] .nav-container {
            flex-direction: row-reverse;
        }

        body[dir="rtl"] .nav-links {
            flex-direction: row-reverse;
        }

        body[dir="rtl"] .logo::before {
            margin-right: 0;
            margin-left: 0.5rem;
        }

        body[dir="rtl"] .nav-links a::after {
            left: auto;
            right: 50%;
            transform: translateX(50%);
        }

        body[dir="rtl"] .search-icon {
            margin-right: 0;
            margin-left: 1rem;
        }

        body[dir="rtl"] .info-grid {
            direction: rtl;
        }

        body[dir="rtl"] .event-item,
        body[dir="rtl"] .exhibition-item {
            border-left: none;
            border-right: 4px solid transparent;
        }

        body[dir="rtl"] .event-item:hover,
        body[dir="rtl"] .exhibition-item:hover {
            transform: translateX(-5px);
            border-left: none;
            border-right: 4px solid var(--accent);
        }

        body[dir="rtl"] .footer-info {
            direction: rtl;
        }

        body[dir="rtl"] .recommendation-badge {
            right: auto;
            left: 1rem;
        }

        body[dir="rtl"] .accessibility-controls {
            right: auto;
            left: 20px;
        }

        body[dir="rtl"] .accessibility-menu {
            right: auto;
            left: 0;
        }

        body[dir="rtl"] .suggestion-icon {
            margin-right: 0;
            margin-left: 1rem;
        }

        body[dir="rtl"] .language-toggle {
            margin-left: 1rem;
        }

        @media (max-width: 768px) {
            body[dir="rtl"] .accessibility-controls {
                left: 15px;
                right: auto;
            }

            .language-toggle {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-container">
            <a href="Home.html" class="logo">ATHAR Museum</a>
            <ul class="nav-links">
                <li><a href="Home.html" class="active">Home</a></li>
                <li><a href="AboutUs.html">About Us</a></li>
                <li><a href="Events.html">Events</a></li>
                <li><a href="Ticketing.html">Ticketing</a></li>
                <li><a href="News.html">News</a></li>
                <li><a href="Exhibitions.html">Exhibitions</a></li>
                <li><a href="Gallery.html">Gallery</a></li>
            </ul>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div id="google_translate_element" style="display: none;"></div>
                <!-- Custom Language Toggle Button -->
                <button class="language-toggle" id="language-toggle" onclick="translateToArabic()"
                    title="Switch Language">
                    <span class="material-icons notranslate">translate</span>
                    <span class="translate-text" id="lang-text">العربية</span>
                </button>

                <a href="Account.html" class="account-icon" title="My Account">
                    <span class="material-icons">person</span>
                </a>
            </div>
        </div>
    </nav>

    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Where Islamic Art Lives</h1>
            <p>Explore intricate patterns, calligraphy, and artifacts that tell the story of a civilization built on
                beauty and meaning.</p>

            <!-- Search Bar replacing CTA button -->
            <div class="search-container">
                <div class="search-wrapper">
                    <span class="material-icons search-icon">search</span>
                    <input type="text" id="hero-search" placeholder="Search exhibitions, events, artworks..."
                        autocomplete="off">
                </div>
                <div class="suggestions-dropdown" id="suggestions-dropdown"></div>
            </div>
        </div>
    </section>

    <section class="museum-info">
        <div class="container">
            <div class="info-grid">
                <div class="info-text">
                    <h2>About Our Museum</h2>
                    <p>Established in 1892, the ATHAR Museum stands as a beacon of cultural preservation and education.
                        Our mission is to inspire curiosity and understanding of our shared human story through
                        carefully curated collections and engaging programs.</p>
                    <p>With over 50,000 artifacts spanning 5,000 years of human civilization, we offer visitors an
                        unparalleled journey through time. Our expertly designed galleries provide context and meaning
                        to the objects that have shaped our world.</p>
                    <div class="info-stats">
                        <div class="stat-box">
                            <h3>50K+</h3>
                            <p>Artifacts</p>
                        </div>
                        <div class="stat-box">
                            <h3>15</h3>
                            <p>Galleries</p>
                        </div>
                        <div class="stat-box">
                            <h3>500K+</h3>
                            <p>Annual Visitors</p>
                        </div>
                        <div class="stat-box">
                            <h3>130</h3>
                            <p>Years of History</p>
                        </div>
                    </div>
                </div>
                <div class="info-image">
                    <div>
                        <h3>Architectural Marvel</h3>
                        <p>Our beautifully restored building combines historic charm with modern amenities</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Personalized Recommendations -->
    <section class="recommendations-section" id="recommendations-section" style="display: none;">
        <div class="container">
            <div class="recommendations-header">
                <h2>
                    <span class="material-icons">auto_awesome</span>
                    Recommended for You
                </h2>
                <br>
                <span class="personalized-badge">✨ Personalized</span>
            </div>
            <p class="recommendations-subtitle">Based on your interests and preferences</p>

            <div id="recommendations-loading" class="loading-recommendations">
                <span class="material-icons" style="font-size: 3rem; animation: spin 2s linear infinite;">explore</span>
                <p>Finding perfect recommendations for you...</p>
            </div>
            <div id="recommendations-container" class="recommendations-grid" style="display: none;"></div>
            <div id="no-recommendations" class="no-recommendations" style="display: none;">
                <span class="material-icons">explore_off</span>
                <h3>No Recommendations Yet</h3>
                <p>Start exploring our gallery and liking artworks to get personalized recommendations!</p>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="section-title">
            <h2>What's On</h2>
        </div>
        <div class="events-exhibitions">
            <div class="section" id="upcoming-events">
                <h2>Upcoming Events</h2>
                <div id="upcoming-events-container">
                    <div class="loading-spinner" style="padding: 2rem;">
                        <div class="spinner"
                            style="border: 3px solid var(--neutral-light); border-top: 3px solid var(--accent); width: 40px; height: 40px;">
                        </div>
                        <p class="loading-text" style="margin-top: 1rem; color: var(--text-light);">Loading upcoming
                            events...</p>
                    </div>
                </div>
            </div>
            <div class="section" id="featured-exhibitions">
                <h2>Featured Exhibitions</h2>
                <div id="featured-exhibitions-container">
                    <div class="loading-spinner" style="padding: 2rem;">
                        <div class="spinner"
                            style="border: 3px solid var(--neutral-light); border-top: 3px solid var(--accent); width: 40px; height: 40px;">
                        </div>
                        <p class="loading-text" style="margin-top: 1rem; color: var(--text-light);">Loading featured
                            exhibitions...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-section">
                    <h3>Visit Us</h3>
                    <p>123 Museum Boulevard</p>
                    <p>Cultural District</p>
                    <p>City, State 12345</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
                <div class="footer-section">
                    <h3>Hours</h3>
                    <p>Monday - Friday: 9:00 AM - 6:00 PM</p>
                    <p>Saturday - Sunday: 10:00 AM - 8:00 PM</p>
                    <p>Closed on major holidays</p>
                </div>
                <div class="footer-section">
                    <h3>Admission</h3>
                    <p>Adults: $15</p>
                    <p>Students/Seniors: $12</p>
                    <p>Children under 12: Free</p>
                    <p>Members: Always Free</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ATHAR Museum. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Include the highlighter script for search navigation -->
    <script src="section-highlighter.js"></script>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import './notification-system.js';

        let currentUser = null;
        let userData = null;
        let allArtworks = [];
        let allUsers = [];
        let searchData = [];
        let allEventsData = [];

        // Interest to Category Mapping
        const interestToCategoryMap = {
            'Manuscripts': 'codices',
            'Weapons': 'arms',
            'Boxes': 'boxes',
            'Bottles': 'bottles'
        };

        const interestToExhibitionMap = {
            'Arab Heritage': 'Arab Heritage',
            'Persian Heritage': 'Persian Heritage',
            'Indian Heritage': 'Indian Heritage',
            'Andalusian Heritage': 'Andalusian Heritage',
            'Turkish Heritage': 'Turkish Heritage',
            'Echoes of Islamic Civilization': 'Others'
        };

        // Load Upcoming Events from Database (Top 3)
        async function loadUpcomingEvents() {
            try {
                const eventsCol = collection(db, 'Events');
                const eventsSnapshot = await getDocs(eventsCol);

                const now = new Date();
                const upcomingEvents = [];

                eventsSnapshot.forEach(doc => {
                    const data = doc.data();
                    const startDate = data.startDate?.toDate();

                    // Only include events that haven't started yet
                    if (startDate && startDate > now) {
                        upcomingEvents.push({
                            id: doc.id,
                            ...data,
                            startDate: startDate
                        });
                    }
                });

                // Sort by date (earliest first) and take top 3
                upcomingEvents.sort((a, b) => a.startDate - b.startDate);
                const top3Events = upcomingEvents.slice(0, 3);

                displayUpcomingEvents(top3Events);
            } catch (error) {
                console.error('Error loading upcoming events:', error);
                document.getElementById('upcoming-events-container').innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        Unable to load events
                    </p>
                `;
            }
        }

        function displayUpcomingEvents(events) {
            const container = document.getElementById('upcoming-events-container');

            if (events.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        No upcoming events at this time
                    </p>
                `;
                return;
            }

            container.innerHTML = events.map(event => {
                const dateStr = event.startDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="event-item" onclick="navigateToEvent('${event.id}')" style="cursor: pointer;">
                        <span class="event-date">${dateStr}</span>
                        <h3>${event.title || 'Untitled Event'}</h3>
                        <p>${event.description || 'No description available'}</p>
                    </div>
                `;
            }).join('');
        }

        // Navigate to event on Events page
        window.navigateToEvent = function (eventId) {
            // Store event ID to highlight
            sessionStorage.setItem('highlightEvent', eventId);
            window.location.href = 'Events.html#event-' + eventId;
        }

        // Calculate most popular interests from all users
        async function getMostPopularInterests() {
            try {
                const usersCol = collection(db, 'Users');
                const usersSnapshot = await getDocs(usersCol);

                const interestCount = {};

                usersSnapshot.forEach(doc => {
                    const data = doc.data();
                    const interests = data.Interests || [];

                    interests.forEach(interest => {
                        interestCount[interest] = (interestCount[interest] || 0) + 1;
                    });
                });

                // Sort interests by count and return top ones
                const sortedInterests = Object.entries(interestCount)
                    .sort((a, b) => b[1] - a[1])
                    .map(entry => entry[0]);

                console.log('Popular interests ranking:', sortedInterests);
                return sortedInterests;
            } catch (error) {
                console.error('Error getting popular interests:', error);
                return [];
            }
        }

        // Load Featured Exhibitions based on most popular interests
        async function loadFeaturedExhibitions() {
            try {
                // Get most popular interests
                const popularInterests = await getMostPopularInterests();

                // Get all artworks
                const artworksCol = collection(db, 'Museum_Collection');
                const artworksSnapshot = await getDocs(artworksCol);

                const exhibitionCounts = {};

                // FIRST: Count ALL artworks per exhibition (accurate counts)
                artworksSnapshot.forEach(doc => {
                    const data = doc.data();
                    let exhibition = data.Exhibition;

                    if (!exhibition) return;

                    // Normalize exhibition name (trim spaces, consistent capitalization)
                    exhibition = exhibition.trim();

                    // Map common variations to standard names
                    const exhibitionMap = {
                        'arab heritage': 'Arab Heritage',
                        'persian heritage': 'Persian Heritage',
                        'indian heritage': 'Indian Heritage',
                        'andalusian heritage': 'Andalusian Heritage',
                        'turkish heritage': 'Turkish Heritage',
                        'others': 'Others'
                    };

                    const normalizedKey = exhibition.toLowerCase();
                    const standardName = exhibitionMap[normalizedKey] || exhibition;

                    // Initialize if new exhibition
                    if (!exhibitionCounts[standardName]) {
                        exhibitionCounts[standardName] = {
                            count: 0,
                            popularityScore: 0
                        };
                    }

                    // Count EVERY artwork in this exhibition
                    exhibitionCounts[standardName].count++;
                });

                // SECOND: Add popularity score based on user interests
                Object.keys(exhibitionCounts).forEach(exhibition => {
                    popularInterests.forEach((interest, index) => {
                        const mappedExhibition = interestToExhibitionMap[interest];
                        if (mappedExhibition === exhibition) {
                            // Higher score for more popular interests (diminishing weight)
                            exhibitionCounts[exhibition].popularityScore += (popularInterests.length - index);
                        }
                    });
                });

                // Sort exhibitions by popularity score, then by count
                const sortedExhibitions = Object.entries(exhibitionCounts)
                    .sort((a, b) => {
                        // First sort by popularity score
                        if (b[1].popularityScore !== a[1].popularityScore) {
                            return b[1].popularityScore - a[1].popularityScore;
                        }
                        // Then by artwork count
                        return b[1].count - a[1].count;
                    })
                    .slice(0, 3);

                console.log('Exhibition counts (normalized):', exhibitionCounts);
                console.log('Top 3 featured:', sortedExhibitions);

                displayFeaturedExhibitions(sortedExhibitions);
            } catch (error) {
                console.error('Error loading featured exhibitions:', error);
                document.getElementById('featured-exhibitions-container').innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        Unable to load exhibitions
                    </p>
                `;
            }
        }

        function displayFeaturedExhibitions(exhibitions) {
            const container = document.getElementById('featured-exhibitions-container');

            if (exhibitions.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        No exhibitions available
                    </p>
                `;
                return;
            }

            container.innerHTML = exhibitions.map(([name, data]) => {
                const artworkCount = data.count;
                const description = getExhibitionDescription(name);

                return `
                    <div class="exhibition-item" onclick="navigateToExhibition('${encodeURIComponent(name)}')" style="cursor: pointer;">
                        <h3>${name}</h3>
                        <span class="event-date">${artworkCount} artwork${artworkCount !== 1 ? 's' : ''}${data.popularityScore > 0 ? ' • Popular Choice' : ''}</span>
                        <p>${description}</p>
                    </div>
                `;
            }).join('');
        }

        // Navigate to exhibition details page
        window.navigateToExhibition = function (exhibitionName) {
            // Navigate to ExhibitionDetails page with exhibition name as parameter
            window.location.href = 'ExhibitionDetails.html?exhibition=' + exhibitionName;
        }

        // Helper function to get exhibition descriptions
        function getExhibitionDescription(exhibitionName) {
            const descriptions = {
                'Arab Heritage': 'Explore the rich cultural treasures of Arab civilization through stunning artifacts and art.',
                'Persian Heritage': 'Discover the art and history of ancient Persia, from intricate textiles to masterful ceramics.',
                'Indian Heritage': 'Journey through thousands of years of Indian civilization and artistic achievement.',
                'Andalusian Heritage': 'Experience the golden age of Andalusian culture and its lasting influence.',
                'Turkish Heritage': 'Discover the treasures of the Ottoman Empire and Turkish artistic traditions.',
                'Others': 'Echoes of Islamic Civilization - A diverse collection spanning the Islamic world.'
            };

            return descriptions[exhibitionName] || 'A remarkable collection showcasing artistic and cultural heritage.';
        }

        // Search Data Structure
        async function buildSearchIndex() {
            console.log('🔍 Starting buildSearchIndex...');
            searchData = [];

            // Add exhibitions
            const exhibitions = [
                { name: 'Arab Heritage', url: 'ExhibitionDetails.html?exhibition=Arab%20Heritage', type: 'exhibition', description: 'Explore Arab cultural treasures' },
                { name: 'Persian Heritage', url: 'ExhibitionDetails.html?exhibition=Persian%20Heritage', type: 'exhibition', description: 'Discover Persian art and history' },
                { name: 'Indian Heritage', url: 'ExhibitionDetails.html?exhibition=Indian%20Heritage', type: 'exhibition', description: 'Journey through Indian civilization' },
                { name: 'Andalusian Heritage', url: 'ExhibitionDetails.html?exhibition=Andalusian%20Heritage', type: 'exhibition', description: 'Experience Andalusian culture' },
                { name: 'Turkish Heritage', url: 'ExhibitionDetails.html?exhibition=Turkish%20Heritage', type: 'exhibition', description: 'Discover Ottoman treasures' },
                { name: 'Others', url: 'ExhibitionDetails.html?exhibition=Others', type: 'exhibition', description: 'Echoes of Islamic Civilization' }
            ];

            // Add pages
            const pages = [
                { name: 'Gallery', url: 'Gallery.html', type: 'page', description: 'Browse our complete art collection' },
                { name: 'Events', url: 'Events.html', type: 'page', description: 'View upcoming museum events' },
                { name: 'News', url: 'News.html', type: 'page', description: 'Latest museum news and updates' },
                { name: 'About Us', url: 'AboutUs.html', type: 'page', description: 'Learn about our museum' },
                { name: 'Ticketing', url: 'Ticketing.html', type: 'page', description: 'Purchase museum tickets' },
                { name: 'Account', url: 'Account.html', type: 'page', description: 'Manage your account' }
            ];

            searchData = [...exhibitions, ...pages];

            // Load events from Firebase
            try {
                const eventsCol = collection(db, 'Events');
                const eventsSnapshot = await getDocs(eventsCol);

                allEventsData = [];

                eventsSnapshot.forEach(doc => {
                    const data = doc.data();
                    const startDate = data.startDate?.toDate();

                    const event = {
                        id: doc.id,
                        title: data.title || 'Untitled Event',
                        description: data.description || '',
                        startDate: startDate,
                        location: data.location || '',
                        ...data
                    };

                    allEventsData.push(event);

                    // Add to search data immediately
                    const dateStr = startDate ? startDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    }) : 'Date TBA';

                    searchData.push({
                        name: event.title,
                        url: `Events.html#event-${event.id}`,
                        type: 'event',
                        date: dateStr,
                        description: event.description || 'Museum event',
                        eventId: event.id,
                        location: event.location || '',
                        // CRITICAL: Include all searchable text in keywords
                        keywords: `${event.title} ${event.description} ${event.location} event museum`.toLowerCase()
                    });
                });

                console.log('✅ Events loaded and added to search:', allEventsData.length);

            } catch (error) {
                console.error('❌ Error loading events:', error);
            }

            // Add artworks
            if (allArtworks && allArtworks.length > 0) {
                allArtworks.forEach(artwork => {
                    searchData.push({
                        name: artwork.title || 'Untitled',
                        url: `ArtDetails.html?id=${artwork.id}`,
                        type: 'artwork',
                        description: `${artwork.artist || artwork.artistName || 'Unknown Artist'} • ${artwork.Exhibition || 'Museum Collection'}`,
                        keywords: [
                            artwork.title,
                            artwork.artist,
                            artwork.artistName,
                            artwork.Exhibition,
                            artwork.classification
                        ].filter(Boolean).join(' ').toLowerCase()
                    });
                });
            }

            console.log('🎉 Search index complete:', searchData.length, 'items');
            console.log('📊 Events in search:', searchData.filter(i => i.type === 'event').length);
        }


        // Search functionality
        function performSearch(query) {
            console.log('🔎 Searching for:', `"${query}"`);

            if (!query || query.trim().length < 2) {
                return [];
            }

            const lowerQuery = query.toLowerCase().trim();
            const results = [];

            console.log('📚 Searching through', searchData.length, 'items');

            searchData.forEach((item, index) => {
                // Build complete search text including name, description, keywords, location, date
                const searchText = [
                    item.name,
                    item.description,
                    item.keywords,
                    item.location,
                    item.date
                ].filter(Boolean).join(' ').toLowerCase();

                // Debug log for events
                if (item.type === 'event') {
                    console.log(`Event #${index}: "${item.name}" - Search text includes: ${searchText.substring(0, 100)}...`);
                }

                if (searchText.includes(lowerQuery)) {
                    let score = 0;
                    if (item.name.toLowerCase().startsWith(lowerQuery)) {
                        score = 100; // Exact match at start
                    } else if (item.name.toLowerCase().includes(lowerQuery)) {
                        score = 50; // Contains in name
                    } else if (item.description && item.description.toLowerCase().includes(lowerQuery)) {
                        score = 30; // Contains in description
                    } else {
                        score = 10; // Contains somewhere else
                    }

                    results.push({ ...item, score });
                    console.log(`✅ Match found: "${item.name}" (${item.type}) - Score: ${score}`);
                }
            });

            console.log(`📊 Found ${results.length} total results`);

            const sortedResults = results
                .sort((a, b) => b.score - a.score)
                .slice(0, 8);

            console.log('🎯 Returning top results:', sortedResults.map(r => `${r.name} (${r.type})`));

            return sortedResults;
        }

        // Test function - use this to debug
        window.testEventsSearch = function () {
            console.log('=== DETAILED EVENTS SEARCH TEST ===');
            console.log('Total search items:', searchData.length);

            const events = searchData.filter(i => i.type === 'event');
            console.log('Events in search data:', events.length);
            console.log('Event titles:');
            events.forEach((e, i) => {
                console.log(`  ${i + 1}. "${e.name}"`);
                console.log(`     Keywords: ${e.keywords.substring(0, 80)}...`);
            });

            // Try searching
            console.log('\n--- Testing search for "workshop" ---');
            const results1 = performSearch('workshop');
            console.log('Results:', results1);

            console.log('\n--- Testing search for "tour" ---');
            const results2 = performSearch('tour');
            console.log('Results:', results2);

            console.log('\n--- Testing search for first event name ---');
            if (events.length > 0) {
                const firstWord = events[0].name.split(' ')[0];
                console.log(`Searching for: "${firstWord}"`);
                const results3 = performSearch(firstWord);
                console.log('Results:', results3);
            }
        };

        // Display search suggestions
        function displaySuggestions(results) {
            const dropdown = document.getElementById('suggestions-dropdown');

            if (results.length === 0) {
                dropdown.innerHTML = `
                    <div class="no-results">
                        <span class="material-icons">search_off</span>
                        <p>No results found</p>
                    </div>
                `;
                dropdown.classList.add('show');
                return;
            }

            const grouped = {
                exhibition: [],
                event: [],
                artwork: [],
                page: []
            };

            results.forEach(result => {
                grouped[result.type].push(result);
            });

            let html = '';

            if (grouped.exhibition.length > 0) {
                html += '<div class="suggestion-category">Exhibitions</div>';
                grouped.exhibition.forEach(item => {
                    html += createSuggestionHTML(item, 'museum');
                });
            }

            if (grouped.event.length > 0) {
                html += '<div class="suggestion-category">Events</div>';
                grouped.event.forEach(item => {
                    html += createSuggestionHTML(item, 'event');
                });
            }

            if (grouped.artwork.length > 0) {
                html += '<div class="suggestion-category">Artworks</div>';
                grouped.artwork.forEach(item => {
                    html += createSuggestionHTML(item, 'palette');
                });
            }

            if (grouped.page.length > 0) {
                html += '<div class="suggestion-category">Pages</div>';
                grouped.page.forEach(item => {
                    html += createSuggestionHTML(item, 'article');
                });
            }

            dropdown.innerHTML = html;
            dropdown.classList.add('show');

            dropdown.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function () {
                    const url = this.dataset.url;
                    const eventId = this.dataset.eventId;

                    if (eventId) {
                        sessionStorage.setItem('highlightEvent', eventId);
                        console.log('✅ Saved event for highlighting:', eventId);
                    }

                    window.location.href = url;
                });
            });
        }

        function createSuggestionHTML(item, icon) {
            const metaText = item.description +
                (item.date ? ' • ' + item.date : '') +
                (item.location ? ' • ' + item.location : '');

            return `
                <div class="suggestion-item" data-url="${item.url}" ${item.eventId ? `data-event-id="${item.eventId}"` : ''}>
                    <span class="material-icons suggestion-icon">${icon}</span>
                    <div class="suggestion-content">
                        <div class="suggestion-title">${item.name}</div>
                        <div class="suggestion-meta">${metaText}</div>
                    </div>
                </div>
            `;
        }

        // Search input handler
        const searchInput = document.getElementById('hero-search');
        const dropdown = document.getElementById('suggestions-dropdown');

        let searchTimeout;
        searchInput.addEventListener('input', function () {
            clearTimeout(searchTimeout);
            const query = this.value;

            if (query.trim().length < 2) {
                dropdown.classList.remove('show');
                return;
            }

            searchTimeout = setTimeout(() => {
                const results = performSearch(query);
                displaySuggestions(results);
            }, 300);
        });

        // Enter key - do nothing, user must click a suggestion
        searchInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault(); // Prevent form submission
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.search-container')) {
                dropdown.classList.remove('show');
            }
        });

        function calculateAge(dateOfBirth) {
            if (!dateOfBirth) return null;
            const birthDate = dateOfBirth.toDate ? dateOfBirth.toDate() : new Date(dateOfBirth);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        function getAgeGroup(age) {
            if (age < 13) return 'child';
            if (age <= 25) return 'youth';
            if (age <= 59) return 'adult';
            return 'senior';
        }

        async function loadData() {
            try {
                const [artworksSnap, usersSnap] = await Promise.all([
                    getDocs(collection(db, "Museum_Collection")),
                    getDocs(collection(db, "Users"))
                ]);

                allArtworks = artworksSnap.docs.map(doc => {
                    const data = doc.data();
                    let cleanImageURL = (data.imageURL || data.ImageURL || '').trim();
                    cleanImageURL = cleanImageURL.replace(/\n/g, '').replace(/\r/g, '');

                    return {
                        id: doc.id,
                        ...data,
                        imageURL: cleanImageURL
                    };
                });

                allUsers = usersSnap.docs.map(doc => {
                    const data = doc.data();
                    const age = calculateAge(data['Date of Birth']);
                    return {
                        id: doc.id,
                        ...data,
                        age: age,
                        ageGroup: age ? getAgeGroup(age) : 'unknown'
                    };
                });

                console.log('✅ Loaded artworks:', allArtworks.length);
                console.log('✅ Loaded users:', allUsers.length);

                // NOW build search index after artworks are loaded
                await buildSearchIndex();

            } catch (error) {
                console.error('❌ Error loading data:', error);
                // Even if there's an error, try to build search index with what we have
                await buildSearchIndex();
            }
        }


        function generateRecommendations() {
            if (!userData || allArtworks.length === 0) {
                return [];
            }

            const userInterests = userData.Interests || [];
            const userAge = calculateAge(userData['Date of Birth']);
            const userAgeGroup = userAge ? getAgeGroup(userAge) : null;
            const userCountry = userData.Country || null;
            const userGender = userData.Gender || null;
            const userLikedArtworks = userData.likedArtworks || [];

            // حساب الحد الديناميكي
            const totalUsers = allUsers.length;
            const minThreshold = totalUsers < 10 ? 1 : 2;
            const trendingThreshold = totalUsers < 10 ? 3 : 5;

            // فلترة الأعمال المعجب بها مسبقاً
            const availableArtworks = allArtworks.filter(art => !userLikedArtworks.includes(art.id));

            const selectedArtworks = new Map(); // لتجنب التكرار
            const recommendations = [];



            // ========== 1. الأكثر شهرة عموماً (Trending) ==========
            const trendingArtwork = availableArtworks
                .filter(art => art.likesCount >= trendingThreshold)
                .sort((a, b) => (b.likesCount || 0) - (a.likesCount || 0))[0];

            if (trendingArtwork) {
                selectedArtworks.set(trendingArtwork.id, {
                    ...trendingArtwork,
                    reasons: ['🔥 Most popular artwork overall'],
                    category: 'trending'
                });
            }

            // ========== 2. الأكثر شهرة في الدولة ==========
            if (userCountry) {
                const countryPopular = availableArtworks
                    .map(art => {
                        const countryLikes = (art.likedBy || []).filter(userId => {
                            const user = allUsers.find(u => u.uid === userId);
                            return user && user.Country === userCountry;
                        }).length;
                        return { ...art, countryLikes };
                    })
                    .filter(art => art.countryLikes >= minThreshold && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.countryLikes - a.countryLikes)[0];

                if (countryPopular) {
                    const existing = selectedArtworks.get(countryPopular.id);
                    if (existing) {
                        existing.reasons.push(`⭐ Most popular in ${userCountry}`);
                    } else {
                        selectedArtworks.set(countryPopular.id, {
                            ...countryPopular,
                            reasons: [`⭐ Most popular in ${userCountry}`],
                            category: 'country'
                        });
                    }
                }
            }

            // ========== 3. الأكثر شهرة عند الجنس ==========
            if (userGender) {
                const genderPopular = availableArtworks
                    .map(art => {
                        const genderLikes = (art.likedBy || []).filter(userId => {
                            const user = allUsers.find(u => u.uid === userId);
                            return user && user.Gender === userGender;
                        }).length;
                        return { ...art, genderLikes };
                    })
                    .filter(art => art.genderLikes >= minThreshold && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.genderLikes - a.genderLikes)[0];

                if (genderPopular) {
                    const existing = selectedArtworks.get(genderPopular.id);
                    const genderText = userGender === 'Female' ? 'women' : 'men';
                    if (existing) {
                        existing.reasons.push(`👥 Most popular among ${genderText}`);
                    } else {
                        selectedArtworks.set(genderPopular.id, {
                            ...genderPopular,
                            reasons: [`👥 Most popular among ${genderText}`],
                            category: 'gender'
                        });
                    }
                }
            }

            // ========== 4. الأكثر شهرة في الفئة العمرية ==========
            if (userAgeGroup) {
                const ageGroupPopular = availableArtworks
                    .map(art => {
                        const ageGroupLikes = (art.likedBy || []).filter(userId => {
                            const user = allUsers.find(u => u.uid === userId);
                            return user && user.ageGroup === userAgeGroup;
                        }).length;
                        return { ...art, ageGroupLikes };
                    })
                    .filter(art => art.ageGroupLikes >= minThreshold && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.ageGroupLikes - a.ageGroupLikes)[0];

                if (ageGroupPopular) {
                    const existing = selectedArtworks.get(ageGroupPopular.id);
                    const ageGroupText = {
                        'child': 'children',
                        'youth': 'youth',
                        'adult': 'adults',
                        'senior': 'seniors'
                    }[userAgeGroup] || 'your age group';

                    if (existing) {
                        existing.reasons.push(`🎯 Most popular among ${ageGroupText}`);
                    } else {
                        selectedArtworks.set(ageGroupPopular.id, {
                            ...ageGroupPopular,
                            reasons: [`🎯 Most popular among ${ageGroupText}`],
                            category: 'ageGroup'
                        });
                    }
                }
            }

            // ========== 5. الباقي من الاهتمامات ==========
            if (userInterests.length > 0) {
                const interestArtworks = availableArtworks
                    .map(art => {
                        let interestScore = 0;
                        let interestReasons = [];

                        userInterests.forEach(interest => {
                            if (interestToExhibitionMap[interest] && art.Exhibition === interestToExhibitionMap[interest]) {
                                interestScore += 3;
                                interestReasons.push(`✨ From ${interest} exhibition`);
                            }
                            if (interestToCategoryMap[interest] && art.classification === interestToCategoryMap[interest]) {
                                interestScore += 3;
                                interestReasons.push(`✨ Matches your interest in ${interest}`);
                            }
                        });

                        return { ...art, interestScore, interestReasons };
                    })
                    .filter(art => art.interestScore > 0 && !selectedArtworks.has(art.id))
                    .sort((a, b) => b.interestScore - a.interestScore);

                // إضافة الأعمال من الاهتمامات حتى نصل إلى 6
                interestArtworks.forEach(art => {
                    if (selectedArtworks.size < 6) {
                        const existing = selectedArtworks.get(art.id);
                        if (existing) {
                            existing.reasons.push(...art.interestReasons);
                        } else {
                            selectedArtworks.set(art.id, {
                                ...art,
                                reasons: art.interestReasons,
                                category: 'interest'
                            });
                        }
                    }
                });
            }

            // ========== 6. إذا لم نصل إلى 6، نملأ بالأعمال الأكثر شهرة ==========
            if (selectedArtworks.size < 6) {
                const remainingArtworks = availableArtworks
                    .filter(art => !selectedArtworks.has(art.id))
                    .sort((a, b) => (b.likesCount || 0) - (a.likesCount || 0))
                    .slice(0, 6 - selectedArtworks.size);

                remainingArtworks.forEach(art => {
                    selectedArtworks.set(art.id, {
                        ...art,
                        reasons: ['⭐ Popular choice'],
                        category: 'general'
                    });
                });
            }

            // تحويل Map إلى Array
            selectedArtworks.forEach(artwork => {
                recommendations.push(artwork);
            });

            return recommendations.slice(0, 6);
        }


        function getBadgeType(rec) {
            switch (rec.category) {
                case 'trending':
                    return 'trending';
                case 'interest':
                    return 'interest';
                case 'country':
                    return 'country';
                case 'gender':
                    return 'gender';
                case 'ageGroup':
                    return 'ageGroup';
                case 'general':
                default:
                    return 'popular';
            }
        }



        function displayRecommendations(recommendations) {
            const loading = document.getElementById('recommendations-loading');
            const container = document.getElementById('recommendations-container');
            const noRecs = document.getElementById('no-recommendations');
            const section = document.getElementById('recommendations-section');

            loading.style.display = 'none';

            if (recommendations.length === 0) {
                noRecs.style.display = 'block';
                section.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            section.style.display = 'block';

            container.innerHTML = recommendations.map(rec => {
                const badgeType = getBadgeType(rec);
                let badgeText = '';

                switch (badgeType) {
                    case 'trending':
                        badgeText = '🔥 Trending';
                        break;
                    case 'interest':
                        badgeText = '✨ For You';
                        break;
                    case 'country':
                        badgeText = '🌍 Top by Country';
                        break;
                    case 'gender':
                        badgeText = '👥 Top by Gender';
                        break;
                    case 'ageGroup':
                        badgeText = '🎯 Top by Age';
                        break;
                    default:
                        badgeText = '⭐ Popular';
                }


                const imageURL = rec.imageURL || '';
                const hasImage = imageURL && imageURL.trim() !== '';

                let imageHTML = '';
                if (hasImage) {
                    imageHTML = `
                        <div class="recommendation-image" style="background-image: url('${imageURL}'); background-size: cover; background-position: center;">
                            <span class="recommendation-badge badge-${badgeType}">${badgeText}</span>
                        </div>
                    `;
                } else {
                    imageHTML = `
                        <div class="recommendation-image no-image">
                            <div style="position: relative; z-index: 1;">🎨 No Image</div>
                            <span class="recommendation-badge badge-${badgeType}">${badgeText}</span>
                        </div>
                    `;
                }

                return `
                    <div class="recommendation-card" onclick="window.location.href='ArtDetails.html?id=${rec.id}'">
                        ${imageHTML}
                        <div class="recommendation-content">
                            <h3 class="recommendation-title">${rec.title || 'Untitled'}</h3>
                            <p class="recommendation-reason">
                                <span class="material-icons" style="font-size: 1rem;">info</span>
                                ${rec.reasons[0]}
                            </p>
                            <p class="recommendation-description">
                                ${rec.artist || rec.artistName || 'Unknown Artist'} • ${rec.Exhibition || 'Museum Collection'}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                try {
                    const userDoc = await getDoc(doc(db, "Users", user.uid));
                    if (userDoc.exists()) {
                        userData = userDoc.data();

                        // 🆕 تأكدي من وجود الجنس
                        console.log('User Gender:', userData.Gender);

                        await loadData();

                        setTimeout(() => {
                            const recommendations = generateRecommendations();
                            displayRecommendations(recommendations);
                        }, 500);
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    document.getElementById('recommendations-section').style.display = 'none';
                }
            } else {
                await loadData();
                document.getElementById('recommendations-section').style.display = 'none';
            }

            loadUpcomingEvents();
            loadFeaturedExhibitions();
        });

        // Navigation scroll effect
        window.addEventListener('scroll', function () {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) {
                nav.style.padding = '0.7rem 0';
                nav.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.1)';
            } else {
                nav.style.padding = '1rem 0';
                nav.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.07)';
            }
        });

        // Set active navigation link
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-links a');

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });

            if (currentPage === '' || currentPage === 'index.html' || currentPage === 'Home.html') {
                const homeLink = document.querySelector('a[href="Home.html"]');
                if (homeLink) {
                    homeLink.classList.add('active');
                }
            }
        });

        // Animation for elements on scroll
        function animateOnScroll() {
            const items = document.querySelectorAll('.event-item, .exhibition-item, .stat-box');
            items.forEach(item => {
                const itemTop = item.getBoundingClientRect().top;
                const itemVisible = 150;

                if (itemTop < window.innerHeight - itemVisible) {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const items = document.querySelectorAll('.event-item, .exhibition-item, .stat-box');
            items.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                item.style.transition = 'all 0.6s ease';
            });

            setTimeout(animateOnScroll, 100);
        });

        window.addEventListener('scroll', animateOnScroll);

        // Check for section to highlight on page load
        document.addEventListener('DOMContentLoaded', function () {
            const sectionToHighlight = sessionStorage.getItem('highlightSection');

            if (sectionToHighlight) {
                // Clear the storage
                sessionStorage.removeItem('highlightSection');

                // Wait a bit for page to fully render
                setTimeout(() => {
                    const targetElement = document.getElementById(sectionToHighlight);

                    if (targetElement) {
                        // Scroll to the element with smooth behavior
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });

                        // Add highlight class
                        targetElement.classList.add('highlight-section');

                        // Remove highlight after animation completes
                        setTimeout(() => {
                            targetElement.classList.remove('highlight-section');
                        }, 2000);
                    }
                }, 500);
            }
        });

        // Add spin animation for loading icon
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // ===== SCREEN READER ACCESSIBILITY SYSTEM =====
        class ScreenReaderSystem {
            constructor() {
                this.isEnabled = false;
                this.isReading = false;
                this.autoReadOnHover = false;
                this.readOnClick = false;
                this.speed = 1.0;
                this.currentElement = null;
                this.hoverTimeout = null;

                this.init();
            }

            init() {
                this.createAccessibilityControls();
                this.loadSettings();
                this.attachEventListeners();
                this.attachSelectListeners();
            }

            attachSelectListeners() {
                // Add listeners to all select elements to read options on keyboard navigation
                document.addEventListener('change', (e) => {
                    if (this.isEnabled && e.target.tagName === 'SELECT') {
                        const selectedOption = e.target.options[e.target.selectedIndex];
                        if (selectedOption) {
                            this.speak(selectedOption.textContent.trim());
                        }
                    }
                });

                // Handle keyboard navigation in selects
                document.addEventListener('keydown', (e) => {
                    if (this.isEnabled && e.target.tagName === 'SELECT') {
                        if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                            setTimeout(() => {
                                const selectedOption = e.target.options[e.target.selectedIndex];
                                if (selectedOption) {
                                    this.speak(selectedOption.textContent.trim());
                                }
                            }, 50);
                        }
                    }
                });

                // Handle hover over options (using mouseenter on SELECT to detect when options are hovered)
                document.addEventListener('mouseenter', (e) => {
                    if (this.isEnabled && this.autoReadOnHover && e.target.tagName === 'OPTION') {
                        const text = e.target.textContent.trim();
                        if (text && text.length > 0 && e.target !== this.currentElement) {
                            this.speak(text);
                            this.currentElement = e.target;
                        }
                    }
                }, true); // Use capture phase

                // Also handle focus events on options
                document.addEventListener('focus', (e) => {
                    if (this.isEnabled && this.autoReadOnHover && e.target.tagName === 'OPTION') {
                        const text = e.target.textContent.trim();
                        if (text && text.length > 0 && e.target !== this.currentElement) {
                            this.speak(text);
                            this.currentElement = e.target;
                        }
                    }
                }, true); // Use capture phase
            }

            createAccessibilityControls() {
                const controls = document.createElement('div');
                controls.className = 'accessibility-controls';
                controls.innerHTML = `
            <button class="accessibility-btn" id="accessibility-toggle" title="Screen Reader Controls" aria-label="Open screen reader controls">
                <span class="material-icons">accessibility_new</span>
            </button>
            <div class="accessibility-menu" id="accessibility-menu" role="menu">
                <h3>Screen Reader</h3>
                
                <div class="menu-option">
                    <label for="enable-reader">Enable Reader</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enable-reader">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="menu-option">
                    <label for="auto-hover">Read on Hover</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-hover" disabled>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="menu-option">
                    <label for="read-click">Read on Click</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="read-click" disabled>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="speed-control">
                    <div class="speed-label">
                        <span>Speech Speed</span>
                        <span id="speed-value">Normal</span>
                    </div>
                    <input type="range" id="speed-control" min="0.5" max="2" step="0.1" value="1">
                </div>
            </div>
        `;
                document.body.appendChild(controls);
            }

            attachEventListeners() {
                document.getElementById('accessibility-toggle').addEventListener('click', () => {
                    const menu = document.getElementById('accessibility-menu');
                    menu.classList.toggle('show');
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.accessibility-controls')) {
                        document.getElementById('accessibility-menu').classList.remove('show');
                    }
                });

                document.getElementById('enable-reader').addEventListener('change', (e) => {
                    this.isEnabled = e.target.checked;
                    const hoverCheckbox = document.getElementById('auto-hover');
                    const clickCheckbox = document.getElementById('read-click');

                    if (this.isEnabled) {
                        hoverCheckbox.disabled = false;
                        clickCheckbox.disabled = false;

                        this.autoReadOnHover = true;
                        this.readOnClick = true;
                        hoverCheckbox.checked = true;
                        clickCheckbox.checked = true;

                        this.speak("Screen reader enabled. Hover over elements to hear them read aloud.");
                        this.enableReader();
                        this.enableHoverReading();
                    } else {
                        hoverCheckbox.disabled = true;
                        clickCheckbox.disabled = true;
                        hoverCheckbox.checked = false;
                        clickCheckbox.checked = false;

                        this.autoReadOnHover = false;
                        this.readOnClick = false;

                        this.speak("Screen reader disabled");
                        this.disableReader();
                    }

                    this.saveSettings();
                });

                document.getElementById('auto-hover').addEventListener('change', (e) => {
                    this.autoReadOnHover = e.target.checked;
                    this.saveSettings();
                    if (this.autoReadOnHover) {
                        this.enableHoverReading();
                    } else {
                        this.disableHoverReading();
                    }
                });

                document.getElementById('read-click').addEventListener('change', (e) => {
                    this.readOnClick = e.target.checked;
                    this.saveSettings();
                });

                document.getElementById('speed-control').addEventListener('input', (e) => {
                    this.speed = parseFloat(e.target.value);
                    this.updateSpeedLabel();
                    this.saveSettings();
                });

                document.addEventListener('keydown', (e) => {
                    if (e.altKey && e.key === 's') {
                        e.preventDefault();
                        this.stopSpeaking();
                    }
                    if (e.altKey && e.key === 'r') {
                        e.preventDefault();
                        const enableCheckbox = document.getElementById('enable-reader');
                        enableCheckbox.checked = !enableCheckbox.checked;
                        enableCheckbox.dispatchEvent(new Event('change'));
                    }
                });
            }

            enableReader() {
                document.body.style.cursor = 'help';
            }

            disableReader() {
                document.body.style.cursor = 'default';
                this.stopSpeaking();
                this.disableHoverReading();
            }

            enableHoverReading() {
                document.addEventListener('mouseover', this.handleHover);
                document.addEventListener('mousemove', this.handleSelectOptions);
            }

            disableHoverReading() {
                document.removeEventListener('mouseover', this.handleHover);
                document.removeEventListener('mousemove', this.handleSelectOptions);
                clearTimeout(this.hoverTimeout);
            }

            handleSelectOptions = (e) => {
                if (!this.isEnabled || !this.autoReadOnHover) return;

                const element = e.target;

                // Skip material icons
                if (element.classList && element.classList.contains('material-icons')) return;

                if (element.tagName === 'OPTION') {
                    clearTimeout(this.hoverTimeout);
                    this.hoverTimeout = setTimeout(() => {
                        if (element !== this.currentElement) {
                            const text = element.textContent.trim();
                            if (text && text.length > 0) {
                                this.speak(text);
                                this.currentElement = element;
                            }
                        }
                    }, 100);
                }
            }

            handleHover = (e) => {
                if (!this.isEnabled || !this.autoReadOnHover) return;

                const element = e.target;

                // Skip material icons
                if (element.classList && element.classList.contains('material-icons')) return;

                clearTimeout(this.hoverTimeout);

                // Use shorter delay for dropdown options
                const delay = element.tagName === 'OPTION' ? 100 : 500;

                this.hoverTimeout = setTimeout(() => {
                    if (element && element !== this.currentElement) {
                        this.readElement(element);
                    }
                }, delay);
            }

            readElement(element) {
                if (!this.isEnabled) return;

                if (['SCRIPT', 'STYLE', 'NOSCRIPT'].includes(element.tagName)) return;
                if (element.offsetParent === null && element.tagName !== 'BODY') return;

                // Skip material icons
                if (element.classList && element.classList.contains('material-icons')) return;

                // Skip if parent is a material icon
                if (element.parentElement && element.parentElement.classList && element.parentElement.classList.contains('material-icons')) return;

                // Skip if element contains only a material icon as child
                const iconChild = element.querySelector('.material-icons');
                if (iconChild && element.textContent.trim() === iconChild.textContent.trim()) return;

                let textToRead = '';
                let isClickable = false;

                const hasClickHandler = element.onclick !== null ||
                    element.hasAttribute('onclick') ||
                    element.style.cursor === 'pointer' ||
                    element.classList.contains('clickable') ||
                    element.hasAttribute('role') && element.getAttribute('role') === 'button';

                // Priority 1: Aria-label
                if (element.getAttribute('aria-label')) {
                    textToRead = element.getAttribute('aria-label');
                    isClickable = hasClickHandler;
                }
                // Priority 2: Title attribute
                else if (element.getAttribute('title')) {
                    textToRead = element.getAttribute('title');
                    isClickable = hasClickHandler;
                }
                // Priority 3: Specific element types
                else if (element.tagName === 'IMG') {
                    textToRead = element.alt || 'Image';
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'A') {
                    textToRead = `Link: ${element.textContent.trim()}`;
                    isClickable = true;
                }
                else if (element.tagName === 'BUTTON') {
                    // Get text content but exclude material icons
                    let buttonText = '';
                    element.childNodes.forEach(node => {
                        if (node.nodeType === Node.TEXT_NODE) {
                            buttonText += node.textContent.trim() + ' ';
                        } else if (node.nodeType === Node.ELEMENT_NODE && !node.classList.contains('material-icons')) {
                            buttonText += node.textContent.trim() + ' ';
                        }
                    });
                    buttonText = buttonText.trim();
                    if (buttonText) {
                        textToRead = `Button: ${buttonText}`;
                        isClickable = true;
                    } else {
                        return; // Skip buttons with only icons
                    }
                }
                else if (element.tagName === 'INPUT') {
                    const label = document.querySelector(`label[for="${element.id}"]`);
                    const labelText = label ? label.textContent.trim() : '';
                    const type = element.type || 'text';
                    const value = element.value || '';

                    if (type === 'checkbox' || type === 'radio') {
                        const state = element.checked ? 'checked' : 'unchecked';
                        textToRead = `${labelText || type} ${state}`;
                    } else if (value) {
                        textToRead = `${labelText || 'Input field'}: current value is ${value}`;
                    } else {
                        textToRead = `${labelText || 'Input field'}: ${element.placeholder || 'empty'}`;
                    }
                    isClickable = true;
                }
                else if (element.tagName === 'TEXTAREA') {
                    const label = document.querySelector(`label[for="${element.id}"]`);
                    const value = element.value || '';
                    textToRead = `Text area ${label ? label.textContent : ''}: ${value || element.placeholder || 'empty'}`;
                    isClickable = true;
                }
                else if (element.tagName === 'SELECT') {
                    const label = document.querySelector(`label[for="${element.id}"]`);
                    const selectedOption = element.options[element.selectedIndex];
                    const selectedText = selectedOption ? selectedOption.text : 'nothing selected';
                    textToRead = `Dropdown menu: ${label ? label.textContent.trim() + ', ' : ''}currently selected: ${selectedText}`;
                    isClickable = true;
                }
                else if (element.tagName === 'OPTION') {
                    textToRead = element.textContent.trim();
                    isClickable = false; // Don't add "clickable" prefix
                }
                else if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(element.tagName)) {
                    textToRead = element.textContent.trim();
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'P') {
                    textToRead = element.textContent.trim();
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'LABEL') {
                    const forElement = element.getAttribute('for');
                    const associatedInput = forElement ? document.getElementById(forElement) : null;
                    textToRead = `Label: ${element.textContent.trim()}`;
                    if (associatedInput) {
                        textToRead += `. Associated with ${associatedInput.tagName.toLowerCase()}`;
                    }
                    isClickable = false;
                }
                else if (element.tagName === 'SPAN') {
                    // Check if it's a counter value or price tag
                    if (element.classList.contains('counter-value')) {
                        textToRead = `Count: ${element.textContent.trim()}`;
                    } else if (element.classList.contains('price-tag')) {
                        textToRead = `Price: ${element.textContent.trim()}`;
                    } else {
                        textToRead = element.textContent.trim();
                    }
                    isClickable = hasClickHandler;
                }
                else if (element.tagName === 'NAV') {
                    textToRead = 'Navigation menu';
                    isClickable = false;
                }
                else if (element.tagName === 'FOOTER') {
                    textToRead = 'Footer section';
                    isClickable = false;
                }
                else if (element.tagName === 'HEADER') {
                    textToRead = 'Header section';
                    isClickable = false;
                }
                else if (element.tagName === 'SECTION') {
                    const heading = element.querySelector('h1, h2, h3, h4, h5, h6');
                    if (heading) {
                        textToRead = `Section: ${heading.textContent.trim()}`;
                    } else {
                        return;
                    }
                    isClickable = hasClickHandler;
                }
                // Enhanced DIV reading
                else if (element.tagName === 'DIV') {
                    // Check for specific interactive components
                    if (element.classList.contains('counter-group')) {
                        const label = element.querySelector('.counter-label');
                        const price = element.querySelector('.counter-price');
                        const count = element.querySelector('.counter-value');
                        if (label && count) {
                            textToRead = `${label.textContent.trim()}: ${count.textContent.trim()} selected. ${price ? price.textContent.trim() : ''}`;
                        }
                        isClickable = true;
                    } else if (element.classList.contains('visit-type-card')) {
                        const title = element.querySelector('h4');
                        const price = element.querySelector('.price-tag');
                        const description = element.querySelector('p:not(.price-tag)');
                        textToRead = `${title ? title.textContent.trim() : 'Visit option'}. ${price ? price.textContent.trim() : ''}. ${description ? description.textContent.trim() : ''}`;
                        isClickable = true;
                    } else if (element.classList.contains('calendar-date')) {
                        const isSelected = element.classList.contains('selected');
                        const isUnavailable = element.classList.contains('unavailable');
                        const dateNum = element.textContent.trim();
                        if (isUnavailable) {
                            textToRead = `Date ${dateNum}: unavailable`;
                        } else if (isSelected) {
                            textToRead = `Date ${dateNum}: currently selected`;
                        } else {
                            textToRead = `Date ${dateNum}: available for booking`;
                        }
                        isClickable = !isUnavailable;
                    } else if (element.classList.contains('form-group')) {
                        const label = element.querySelector('.form-label');
                        const input = element.querySelector('input, select, textarea');
                        if (label) {
                            textToRead = `Form field: ${label.textContent.trim()}`;
                            if (input && input.tagName === 'SELECT') {
                                const selected = input.options[input.selectedIndex];
                                textToRead += `. Currently: ${selected ? selected.text : 'not selected'}`;
                            }
                        }
                        isClickable = false;
                    } else if (element.classList.contains('summary-item')) {
                        textToRead = element.textContent.trim().replace(/\s+/g, ' ');
                    } else if (element.classList.contains('summary-total')) {
                        textToRead = `Total amount: ${element.textContent.trim().replace(/\s+/g, ' ')}`;
                    } else if (element.classList.contains('member-status-card')) {
                        const greeting = element.querySelector('#member-greeting');
                        const desc = element.querySelector('#member-description');
                        const badge = element.querySelector('#member-badge');
                        if (greeting && desc && badge) {
                            textToRead = `${greeting.textContent.trim()}. ${desc.textContent.trim()}. ${badge.textContent.trim()}`;
                        }
                    } else if (hasClickHandler) {
                        const heading = element.querySelector('h1, h2, h3, h4, h5, h6');
                        if (heading) {
                            textToRead = heading.textContent.trim();
                        } else {
                            const firstText = element.textContent.trim().substring(0, 150);
                            textToRead = firstText;
                        }
                        isClickable = true;
                    } else {
                        // Read direct text content only
                        const directText = Array.from(element.childNodes)
                            .filter(node => node.nodeType === Node.TEXT_NODE)
                            .map(node => node.textContent.trim())
                            .filter(text => text.length > 0)
                            .join(' ');

                        if (directText) {
                            textToRead = directText;
                        } else {
                            return;
                        }
                    }
                }
                else {
                    textToRead = Array.from(element.childNodes)
                        .filter(node => node.nodeType === Node.TEXT_NODE)
                        .map(node => node.textContent.trim())
                        .filter(text => text.length > 0)
                        .join(' ');

                    isClickable = hasClickHandler;
                }

                // Clean up the text
                textToRead = textToRead.trim().replace(/\s+/g, ' ');

                // Add clickable indicator if needed
                if (isClickable && textToRead && !textToRead.toLowerCase().includes('button') && !textToRead.toLowerCase().includes('link') && !textToRead.toLowerCase().includes('clickable')) {
                    textToRead = `Clickable: ${textToRead}`;
                }

                // Speak if we have meaningful text
                if (textToRead && textToRead.length > 1) {
                    this.speak(textToRead);
                    this.currentElement = element;
                    this.highlightElement(element);
                }
            }

            highlightElement(element) {
                document.querySelectorAll('.sr-highlight').forEach(el => {
                    el.classList.remove('sr-highlight');
                });

                element.classList.add('sr-highlight');
                setTimeout(() => {
                    element.classList.remove('sr-highlight');
                }, 2000);
            }

            speak(text) {
                if (!text || text.trim().length === 0) return;

                this.stopSpeaking();

                if (typeof responsiveVoice !== 'undefined') {
                    responsiveVoice.speak(text, "US English Female", {
                        rate: this.speed,
                        pitch: 1,
                        volume: 1
                    });
                } else {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = this.speed;
                    utterance.pitch = 1;
                    utterance.volume = 1;
                    window.speechSynthesis.speak(utterance);
                }

                this.isReading = true;
            }

            stopSpeaking() {
                if (typeof responsiveVoice !== 'undefined') {
                    responsiveVoice.cancel();
                } else {
                    window.speechSynthesis.cancel();
                }
                this.isReading = false;
                this.currentElement = null;
            }

            updateSpeedLabel() {
                const label = document.getElementById('speed-value');
                if (this.speed < 0.8) {
                    label.textContent = 'Slow';
                } else if (this.speed > 1.2) {
                    label.textContent = 'Fast';
                } else {
                    label.textContent = 'Normal';
                }
            }

            saveSettings() {
                localStorage.setItem('screenReaderSettings', JSON.stringify({
                    enabled: this.isEnabled,
                    autoHover: this.autoReadOnHover,
                    readClick: this.readOnClick,
                    speed: this.speed
                }));
            }

            loadSettings() {
                const saved = localStorage.getItem('screenReaderSettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    this.isEnabled = settings.enabled || false;
                    this.autoReadOnHover = settings.autoHover || false;
                    this.readOnClick = settings.readClick || false;
                    this.speed = settings.speed || 1.0;

                    const hoverCheckbox = document.getElementById('auto-hover');
                    const clickCheckbox = document.getElementById('read-click');

                    document.getElementById('enable-reader').checked = this.isEnabled;
                    document.getElementById('speed-control').value = this.speed;
                    this.updateSpeedLabel();

                    if (this.isEnabled) {
                        hoverCheckbox.disabled = false;
                        clickCheckbox.disabled = false;
                        hoverCheckbox.checked = this.autoReadOnHover;
                        clickCheckbox.checked = this.readOnClick;

                        this.enableReader();
                        if (this.autoReadOnHover) {
                            this.enableHoverReading();
                        }
                    } else {
                        hoverCheckbox.disabled = true;
                        clickCheckbox.disabled = true;
                        hoverCheckbox.checked = false;
                        clickCheckbox.checked = false;
                    }
                }
            }
        }

        // Initialize screen reader when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.screenReader = new ScreenReaderSystem();

                document.addEventListener('click', (e) => {
                    // Skip material icons
                    if (e.target.classList && e.target.classList.contains('material-icons')) return;

                    if (window.screenReader && window.screenReader.isEnabled && window.screenReader.readOnClick) {
                        window.screenReader.readElement(e.target);
                    }
                });
            });
        } else {
            window.screenReader = new ScreenReaderSystem();

            document.addEventListener('click', (e) => {
                // Skip material icons
                if (e.target.classList && e.target.classList.contains('material-icons')) return;

                if (window.screenReader && window.screenReader.isEnabled && window.screenReader.readOnClick) {
                    window.screenReader.readElement(e.target);
                }
            });
        }
    </script>
</body>

</html>