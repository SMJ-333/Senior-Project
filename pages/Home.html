<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATHAR Museum - Discover History</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #653025;
            --primary-light: #8d2e1d;
            --accent: #b08d57;
            --accent-light: #d4b483;
            --neutral-light: #f4f1e3;
            --neutral-dark: #4a3c2a;
            --text-dark: #3b2f23;
            --text-light: #7c6f57;
            --white: #fdfaf4;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--neutral-light);
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            line-height: 1.2;
        }

        nav {
            background: var(--white);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1300px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "‚óà";
            color: var(--accent);
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 80%;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-dark);
        }

        .account-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--white);
            color: var(--primary-dark);
            font-size: 1.2rem;
            border: 2px solid var(--accent);
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
        }

        .account-icon:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 15px rgba(26, 54, 93, 0.25);
            border-color: var(--accent-light);
        }

        .hero {
            height: 100vh;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #d9d4be;
            background: url("../images/RedRug.jpg") no-repeat top right;
            background-size: cover;
        }

        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            padding: 2rem;
            animation: fadeIn 1s ease-out;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            letter-spacing: -0.5px;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2.5rem;
            font-weight: 300;
            opacity: 0.9;
        }

        .cta-button {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary-dark);
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: var(--transition);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 5rem 2rem;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title h2 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            display: inline-block;
            margin-bottom: 1rem;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: var(--accent);
            margin: 0 auto;
        }

        .section-title .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            margin-top: 0.5rem;
        }

        /* Recommendations Section */
        .recommendations-section {
            background: var(--white);
            padding: 4rem 0;
            margin: 3rem 0;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .recommendations-header {
            text-align: center;
            margin-bottom: 1rem;
        }

        .recommendations-header h2 {
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            color: var(--primary-dark);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .recommendations-header .material-icons {
            font-size: 2.5rem;
            color: var(--accent);
        }

        .personalized-badge {
            display: inline-block;
            background: var(--neutral-light);
            color: var(--accent);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
            border: 2px solid var(--accent);
        }

        .recommendations-subtitle {
            color: var(--text-light);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            text-align: center;
            margin: 1rem 0 2.5rem;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            padding: 0 2rem;
        }

        .recommendation-card {
            background: var(--neutral-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .recommendation-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .recommendation-image.no-image {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1rem;
        }

        .recommendation-image.no-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" opacity="0.1"><rect fill="%23ffffff" width="200" height="200"/><path d="M40,40 C60,20 80,40 100,30 C120,20 140,40 160,30 C180,20 200,40 200,40 L200,200 L40,200 Z" fill="%23d4af37"/></svg>');
            background-size: cover;
        }

        .recommendation-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .badge-trending {
            background: rgba(255, 99, 71, 0.9);
            color: white;
        }

        .badge-interest {
            background: rgba(176, 141, 87, 0.9);
            color: white;
        }

        .badge-popular {
            background: rgba(72, 187, 120, 0.9);
            color: white;
        }

        .recommendation-content {
            padding: 1.5rem;
        }

        .recommendation-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .recommendation-reason {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .recommendation-description {
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        .loading-recommendations {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-recommendations {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-recommendations .material-icons {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Museum Info */
        .museum-info {
            background: var(--white);
            padding: 5rem 0;
            border-radius: 12px;
            margin: 3rem 0;
            box-shadow: var(--shadow);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
        }

        .info-text h2 {
            color: var(--primary-dark);
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .info-text p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .info-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2.5rem;
        }

        .stat-box {
            background: var(--neutral-light);
            padding: 1.8rem;
            border-radius: 10px;
            text-align: center;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            border-bottom: 3px solid var(--accent);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .stat-box h3 {
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stat-box p {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 0;
        }

        .info-image {
            background: linear-gradient(45deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            height: 450px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .info-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" opacity="0.1"><rect fill="%23ffffff" width="200" height="200"/><path d="M40,40 C60,20 80,40 100,30 C120,20 140,40 160,30 C180,20 200,40 200,40 L200,200 L40,200 Z" fill="%23d4af37"/></svg>');
            background-size: cover;
        }

        .info-image div {
            position: relative;
            z-index: 1;
            padding: 2rem;
        }

        .info-image h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        /* Events and Exhibitions */
        .events-exhibitions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            margin: 5rem 0;
        }

        .section {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: var(--primary-dark);
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: var(--accent);
        }

        .event-item,
        .exhibition-item {
            background: var(--neutral-light);
            padding: 1.8rem;
            margin-bottom: 1.8rem;
            border-radius: 10px;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .event-item:hover,
        .exhibition-item:hover {
            transform: translateX(5px);
            border-left: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .event-item h3,
        .exhibition-item h3 {
            color: var(--primary-dark);
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
        }

        .event-date {
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            display: block;
        }

        .event-item p,
        .exhibition-item p {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 4rem 0 2rem;
            margin-top: 5rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h3 {
            color: var(--accent-light);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .footer-section p {
            margin-bottom: 0.8rem;
            opacity: 0.9;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 992px) {
            .hero-content h1 {
                font-size: 2.8rem;
            }

            .info-grid {
                gap: 3rem;
            }

            .recommendations-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero-content h1 {
                font-size: 2.3rem;
            }

            .hero-content p {
                font-size: 1.1rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .events-exhibitions {
                grid-template-columns: 1fr;
                gap: 2.5rem;
            }

            .info-stats {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 2rem;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .hero-content h1 {
                font-size: 2rem;
            }

            .container {
                padding: 4rem 1.5rem;
            }

            .info-image {
                height: 350px;
            }

            .stat-box {
                padding: 1.5rem;
            }
        }

        /* Notification Badge on Account Icon */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid var(--white);
            animation: pulse 2s infinite;
            z-index: 10;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        /* Make sure account icon has position relative */
        .account-icon {
            position: relative;
            /* ... keep your existing account-icon styles ... */
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-container">
            <a href="Home.html" class="logo">ATHAR Museum</a>
            <ul class="nav-links">
                <li><a href="Home.html" class="active">Home</a></li>
                <li><a href="AboutUs.html">About Us</a></li>
                <li><a href="Events.html">Events</a></li>
                <li><a href="Ticketing.html">Ticketing</a></li>
                <li><a href="News.html">News</a></li>
                <li><a href="Exhibitions.html">Exhibitions</a></li>
                <li><a href="Gallery.html">Gallery</a></li>
            </ul>
            <a href="Account.html" class="account-icon" title="My Account"><span
                    class="material-icons">person</span></a>
        </div>
    </nav>

    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Discover Timeless ATHAR</h1>
            <p>Experience centuries of art, culture, and history through our world-class collections and immersive
                exhibitions.</p>
            <a href="Exhibitions.html" class="cta-button">Explore Exhibitions</a>
        </div>
    </section>

    <section class="museum-info">
        <div class="container">
            <div class="info-grid">
                <div class="info-text">
                    <h2>About Our Museum</h2>
                    <p>Established in 1892, the ATHAR Museum stands as a beacon of cultural preservation and education.
                        Our mission is to inspire curiosity and understanding of our shared human story through
                        carefully curated collections and engaging programs.</p>
                    <p>With over 50,000 artifacts spanning 5,000 years of human civilization, we offer visitors an
                        unparalleled journey through time. Our expertly designed galleries provide context and meaning
                        to the objects that have shaped our world.</p>
                    <div class="info-stats">
                        <div class="stat-box">
                            <h3>50K+</h3>
                            <p>Artifacts</p>
                        </div>
                        <div class="stat-box">
                            <h3>15</h3>
                            <p>Galleries</p>
                        </div>
                        <div class="stat-box">
                            <h3>500K+</h3>
                            <p>Annual Visitors</p>
                        </div>
                        <div class="stat-box">
                            <h3>130</h3>
                            <p>Years of History</p>
                        </div>
                    </div>
                </div>
                <div class="info-image">
                    <div>
                        <h3>Architectural Marvel</h3>
                        <p>Our beautifully restored building combines historic charm with modern amenities</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Personalized Recommendations -->
    <section class="recommendations-section" id="recommendations-section" style="display: none;">
        <div class="container">
            <div class="recommendations-header">
                <h2>
                    <span class="material-icons">auto_awesome</span>
                    Recommended for You
                </h2>
                <br>
                <span class="personalized-badge">‚ú® Personalized</span>
            </div>
            <p class="recommendations-subtitle">Based on your interests and preferences</p>

            <div id="recommendations-loading" class="loading-recommendations">
                <span class="material-icons" style="font-size: 3rem; animation: spin 2s linear infinite;">explore</span>
                <p>Finding perfect recommendations for you...</p>
            </div>
            <div id="recommendations-container" class="recommendations-grid" style="display: none;"></div>
            <div id="no-recommendations" class="no-recommendations" style="display: none;">
                <span class="material-icons">explore_off</span>
                <h3>No Recommendations Yet</h3>
                <p>Start exploring our gallery and liking artworks to get personalized recommendations!</p>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="section-title">
            <h2>What's On</h2>
        </div>
        <div class="events-exhibitions">
            <div class="section">
                <h2>Upcoming Events</h2>
                <div class="event-item">
                    <span class="event-date">October 25, 2025 ‚Ä¢ 6:30 PM</span>
                    <h3>Ancient Egypt Night Tour</h3>
                    <p>Experience the mysteries of ancient Egypt in a special after-hours guided tour.</p>
                </div>
                <div class="event-item">
                    <span class="event-date">November 12, 2025 ‚Ä¢ 10:00 AM</span>
                    <h3>Renaissance Art Workshop</h3>
                    <p>Learn traditional painting techniques from master artists.</p>
                </div>
                <div class="event-item">
                    <span class="event-date">November 28, 2025 ‚Ä¢ 11:00 AM</span>
                    <h3>Family Discovery Day</h3>
                    <p>A special event designed for families with interactive exhibits.</p>
                </div>
            </div>
            <div class="section">
                <h2>Featured Exhibitions</h2>
                <div class="exhibition-item">
                    <h3>Treasures of Ancient Rome</h3>
                    <span class="event-date">Now through December 2025</span>
                    <p>Marvel at authentic Roman artifacts including sculptures, mosaics, and everyday objects.</p>
                </div>
                <div class="exhibition-item">
                    <h3>Modern Masters: 20th Century Art</h3>
                    <span class="event-date">Permanent Collection</span>
                    <p>Explore works by Picasso, Van Gogh, and other influential artists.</p>
                </div>
                <div class="exhibition-item">
                    <h3>Lost Civilizations of the Americas</h3>
                    <span class="event-date">Opening November 2025</span>
                    <p>Discover the sophisticated cultures of pre-Columbian America.</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-section">
                    <h3>Visit Us</h3>
                    <p>123 Museum Boulevard</p>
                    <p>Cultural District</p>
                    <p>City, State 12345</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
                <div class="footer-section">
                    <h3>Hours</h3>
                    <p>Monday - Friday: 9:00 AM - 6:00 PM</p>
                    <p>Saturday - Sunday: 10:00 AM - 8:00 PM</p>
                    <p>Closed on major holidays</p>
                </div>
                <div class="footer-section">
                    <h3>Admission</h3>
                    <p>Adults: $15</p>
                    <p>Students/Seniors: $12</p>
                    <p>Children under 12: Free</p>
                    <p>Members: Always Free</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ATHAR Museum. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import './notification-system.js';

        let currentUser = null;
        let userData = null;
        let allArtworks = [];
        let allUsers = [];

        // Interest to Category Mapping
        const interestToCategoryMap = {
            'Manuscripts': 'codices',
            'Weapons': 'arms',
            'Boxes': 'boxes',
            'Bottles': 'bottles'
        };

        const interestToExhibitionMap = {
            'Arab Heritage': 'Arab Heritage',
            'Persian Heritage': 'Persian Heritage',
            'Indian Heritage': 'Indian Heritage',
            'Andalusian Heritage': 'Andalusian Heritage',
            'Turkish Heritage': 'Turkish Heritage',
            'Echoes of Islamic Civilization': 'Others'
        };

        function calculateAge(dateOfBirth) {
            if (!dateOfBirth) return null;
            const birthDate = dateOfBirth.toDate ? dateOfBirth.toDate() : new Date(dateOfBirth);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        function getAgeGroup(age) {
            if (age < 13) return 'child';
            if (age <= 25) return 'youth';
            if (age <= 59) return 'adult';
            return 'senior';
        }

        async function loadData() {
            try {
                const [artworksSnap, usersSnap] = await Promise.all([
                    getDocs(collection(db, "Museum_Collection")),
                    getDocs(collection(db, "Users"))
                ]);

                allArtworks = artworksSnap.docs.map(doc => {
                    const data = doc.data();
                    // Clean imageURL by removing newlines and extra spaces
                    let cleanImageURL = (data.imageURL || data.ImageURL || '').trim();
                    cleanImageURL = cleanImageURL.replace(/\n/g, '').replace(/\r/g, '');

                    return {
                        id: doc.id,
                        ...data,
                        imageURL: cleanImageURL
                    };
                });

                allUsers = usersSnap.docs.map(doc => {
                    const data = doc.data();
                    const age = calculateAge(data['Date of Birth']);
                    return {
                        id: doc.id,
                        ...data,
                        age: age,
                        ageGroup: age ? getAgeGroup(age) : 'unknown'
                    };
                });

                console.log('Loaded artworks:', allArtworks.length);
                console.log('Sample artwork:', allArtworks[0]);
                console.log('First artwork imageURL:', allArtworks[0]?.imageURL);
                console.log('First artwork full data:', JSON.stringify(allArtworks[0], null, 2));
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function generateRecommendations() {
            if (!userData || !userData.Interests || allArtworks.length === 0) {
                return [];
            }

            const recommendations = [];
            const userInterests = userData.Interests || [];
            const userAge = calculateAge(userData['Date of Birth']);
            const userAgeGroup = userAge ? getAgeGroup(userAge) : null;
            const userCountry = userData.Country || null;
            const userLikedArtworks = userData.likedArtworks || [];

            // Score each artwork
            allArtworks.forEach(artwork => {
                let score = 0;
                let reasons = [];

                // 1. Interest Match (Exhibition + Category) - Weight: 3
                userInterests.forEach(interest => {
                    // Check Exhibition match
                    if (interestToExhibitionMap[interest] && artwork.Exhibition === interestToExhibitionMap[interest]) {
                        score += 3;
                        reasons.push(`Matches your interest in ${interest}`);
                    }
                    // Check Category match
                    if (interestToCategoryMap[interest] && artwork.classification === interestToCategoryMap[interest]) {
                        score += 3;
                        reasons.push(`You like ${interest}`);
                    }
                });

                // 2. Popular in Age Group - Weight: 2
                if (userAgeGroup && artwork.likedBy && artwork.likedBy.length > 0) {
                    const ageGroupLikes = artwork.likedBy.filter(userId => {
                        const user = allUsers.find(u => u.uid === userId);
                        return user && user.ageGroup === userAgeGroup;
                    }).length;

                    if (ageGroupLikes >= 2) {
                        score += 2;
                        reasons.push(`Popular with your age group`);
                    }
                }

                // 3. Popular in Country - Weight: 2
                if (userCountry && artwork.likedBy && artwork.likedBy.length > 0) {
                    const countryLikes = artwork.likedBy.filter(userId => {
                        const user = allUsers.find(u => u.uid === userId);
                        return user && user.Country === userCountry;
                    }).length;

                    if (countryLikes >= 2) {
                        score += 2;
                        reasons.push(`Popular in ${userCountry}`);
                    }
                }

                // 4. Trending (High likes overall) - Weight: 1
                if (artwork.likesCount && artwork.likesCount >= 5) {
                    score += 1;
                    reasons.push(`Trending artwork`);
                }

                // 5. Not already liked by user
                if (userLikedArtworks.includes(artwork.id)) {
                    score = 0; // Don't recommend already liked items
                }

                if (score > 0) {
                    recommendations.push({
                        ...artwork,
                        score: score,
                        reasons: reasons
                    });
                }
            });

            // Sort by score and get top 6
            return recommendations
                .sort((a, b) => b.score - a.score)
                .slice(0, 6);
        }

        function getBadgeType(reasons) {
            if (reasons.some(r => r.includes('Trending'))) return 'trending';
            if (reasons.some(r => r.includes('interest'))) return 'interest';
            return 'popular';
        }

        function displayRecommendations(recommendations) {
            const loading = document.getElementById('recommendations-loading');
            const container = document.getElementById('recommendations-container');
            const noRecs = document.getElementById('no-recommendations');
            const section = document.getElementById('recommendations-section');

            loading.style.display = 'none';

            if (recommendations.length === 0) {
                noRecs.style.display = 'block';
                section.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            section.style.display = 'block';

            container.innerHTML = recommendations.map(rec => {
                const badgeType = getBadgeType(rec.reasons);
                const badgeText = badgeType === 'trending' ? 'üî• Trending' :
                    badgeType === 'interest' ? '‚ú® For You' :
                        '‚≠ê Popular';

                // Get image URL
                const imageURL = rec.imageURL || '';
                console.log('Rendering card for:', rec.title, 'with imageURL:', imageURL);

                const hasImage = imageURL && imageURL.trim() !== '';

                // Create image element or placeholder
                let imageHTML = '';
                if (hasImage) {
                    imageHTML = `
                        <div class="recommendation-image" style="background-image: url('${imageURL}'); background-size: cover; background-position: center;">
                            <span class="recommendation-badge badge-${badgeType}">${badgeText}</span>
                        </div>
                    `;
                } else {
                    imageHTML = `
                        <div class="recommendation-image no-image">
                            <div style="position: relative; z-index: 1;">üé® No Image</div>
                            <span class="recommendation-badge badge-${badgeType}">${badgeText}</span>
                        </div>
                    `;
                }

                return `
                    <div class="recommendation-card" onclick="window.location.href='ArtDetails.html?id=${rec.id}'">
                        ${imageHTML}
                        <div class="recommendation-content">
                            <h3 class="recommendation-title">${rec.title || 'Untitled'}</h3>
                            <p class="recommendation-reason">
                                <span class="material-icons" style="font-size: 1rem;">info</span>
                                ${rec.reasons[0]}
                            </p>
                            <p class="recommendation-description">
                                ${rec.artist || rec.artistName || 'Unknown Artist'} ‚Ä¢ ${rec.Exhibition || 'Museum Collection'}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                try {
                    // Load user data first
                    const userDoc = await getDoc(doc(db, "Users", user.uid));
                    if (userDoc.exists()) {
                        userData = userDoc.data();

                        // Then load all data
                        await loadData();

                        // Wait a bit to ensure data is loaded
                        setTimeout(() => {
                            const recommendations = generateRecommendations();
                            console.log('Generated recommendations:', recommendations);

                            // Check first recommendation
                            if (recommendations.length > 0) {
                                console.log('First recommendation title:', recommendations[0].title);
                                console.log('First recommendation imageURL:', recommendations[0].imageURL);
                            }

                            displayRecommendations(recommendations);
                        }, 500);
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    document.getElementById('recommendations-section').style.display = 'none';
                }
            } else {
                // User not logged in - hide recommendations section
                document.getElementById('recommendations-section').style.display = 'none';
            }
        });

        // Navigation scroll effect
        window.addEventListener('scroll', function () {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) {
                nav.style.padding = '0.7rem 0';
                nav.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.1)';
            } else {
                nav.style.padding = '1rem 0';
                nav.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.07)';
            }
        });

        // Set active navigation link
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-links a');

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });

            if (currentPage === '' || currentPage === 'index.html' || currentPage === 'Home.html') {
                const homeLink = document.querySelector('a[href="Home.html"]');
                if (homeLink) {
                    homeLink.classList.add('active');
                }
            }
        });

        // Animation for elements on scroll
        function animateOnScroll() {
            const items = document.querySelectorAll('.event-item, .exhibition-item, .stat-box');
            items.forEach(item => {
                const itemTop = item.getBoundingClientRect().top;
                const itemVisible = 150;

                if (itemTop < window.innerHeight - itemVisible) {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }
            });
        }

        // Initialize animations
        document.addEventListener('DOMContentLoaded', function () {
            const items = document.querySelectorAll('.event-item, .exhibition-item, .stat-box');
            items.forEach(item => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                item.style.transition = 'all 0.6s ease';
            });

            setTimeout(animateOnScroll, 100);
        });

        window.addEventListener('scroll', animateOnScroll);

        // CTA button hover effect
        const ctaButton = document.querySelector('.cta-button');
        if (ctaButton) {
            ctaButton.addEventListener('mouseover', function () {
                this.style.background = 'linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%)';
            });

            ctaButton.addEventListener('mouseout', function () {
                this.style.background = 'linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%)';
            });
        }

        // Add spin animation for loading icon
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>