<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heritage Museum - Your Interests</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #1a365d;
            --primary-light: #2d4e8f;
            --accent: #d4af37;
            --accent-light: #e6c875;
            --neutral-light: #f8f9fa;
            --neutral-dark: #2d3748;
            --text-dark: #2d3748;
            --text-light: #718096;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-large: 0 15px 35px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --success: #38a169;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" opacity="0.05"><rect fill="%23ffffff" width="1200" height="800"/><path d="M0,200 C200,100 400,300 600,200 C800,100 1000,150 1200,200 L1200,800 L0,800 Z" fill="%23d4af37"/><circle cx="200" cy="150" r="3" fill="%23ffffff"/><circle cx="800" cy="250" r="2" fill="%23ffffff"/><circle cx="1000" cy="100" r="4" fill="%23ffffff"/></svg>');
            background-size: cover;
            background-position: center;
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            line-height: 1.2;
        }

        .preferences-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .preferences-card {
            background: var(--white);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: var(--shadow-large);
            width: 100%;
            max-width: 900px;
            position: relative;
            backdrop-filter: blur(10px);
            animation: slideUp 0.6s ease-out;
        }

        .preferences-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border-radius: 20px 20px 0 0;
        }

        .preferences-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .preferences-header .logo-icon {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 1rem;
            display: block;
        }

        .preferences-header h1 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .preferences-header p {
            color: var(--text-light);
            font-size: 1.1rem;
            max-width: 650px;
            margin: 0 auto;
            line-height: 1.7;
        }

        .welcome-message {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(230, 200, 117, 0.1) 100%);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin-bottom: 2.5rem;
            border-left: 4px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .welcome-message::before {
            content: '‚ú®';
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            opacity: 0.6;
        }

        .welcome-message h3 {
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-size: 1.3rem;
        }

        .welcome-message p {
            color: var(--text-light);
            margin: 0;
        }

        .selection-count {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 1rem;
            background: var(--neutral-light);
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .selection-count p {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
        }

        .selection-count .count-display {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .selection-count .count {
            color: var(--accent);
            font-weight: 700;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .category-card {
            background: var(--neutral-light);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 2rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            opacity: 0;
            transition: var(--transition);
            z-index: 1;
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            border-color: var(--accent-light);
        }

        .category-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(230, 200, 117, 0.15) 100%);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(212, 175, 55, 0.2);
        }

        .category-card.selected::before {
            opacity: 0.08;
        }

        .category-card.selected::after {
            content: '‚úì';
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--accent);
            color: var(--primary-dark);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 3;
            animation: checkmarkBounce 0.3s ease;
        }

        .category-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .category-icon {
            font-size: 3.2rem;
            margin-bottom: 1.2rem;
            display: block;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .category-card h3 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }

        .category-card p {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .category-details {
            margin-top: 0.8rem;
            font-size: 0.85rem;
            color: var(--text-light);
            opacity: 0.8;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .continue-button {
            flex: 2;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary-dark);
            padding: 1.3rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            opacity: 0.6;
            pointer-events: none;
            position: relative;
            overflow: hidden;
        }

        .continue-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: var(--transition);
        }

        .continue-button.enabled {
            opacity: 1;
            pointer-events: auto;
        }

        .continue-button.enabled:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .continue-button.enabled:hover::before {
            left: 100%;
        }

        .continue-button .loading {
            display: none;
        }

        .continue-button.loading .loading {
            display: inline-block;
            margin-right: 0.5rem;
            animation: spin 1s linear infinite;
        }

        .select-all-button {
            flex: 1;
            background: transparent;
            color: var(--accent);
            border: 2px solid var(--accent);
            padding: 1.3rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .select-all-button:hover {
            background: var(--accent);
            color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .skip-link {
            text-align: center;
        }

        .skip-link a {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }

        .skip-link a:hover {
            color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
        }

        .completion-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(26, 54, 93, 0.95) 0%, rgba(45, 78, 143, 0.95) 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .completion-content {
            text-align: center;
            color: var(--white);
            animation: fadeInScale 0.6s ease-out;
        }

        .completion-content .success-icon {
            font-size: 4rem;
            color: var(--accent);
            margin-bottom: 1rem;
            animation: bounceIn 0.8s ease-out 0.3s both;
        }

        .completion-content h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            animation: slideInUp 0.6s ease-out 0.6s both;
        }

        .completion-content p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 500px;
            margin: 0 auto;
            animation: slideInUp 0.6s ease-out 0.8s both;
        }

        /* Animations */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes checkmarkBounce {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .preferences-container {
                padding: 2rem 1rem;
            }

            .preferences-card {
                padding: 2rem;
            }

            .preferences-header h1 {
                font-size: 2rem;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }

            .category-card {
                padding: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .completion-content h2 {
                font-size: 2rem;
            }

            .completion-content p {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 576px) {
            .preferences-card {
                padding: 1.5rem;
            }

            .category-icon {
                font-size: 2.5rem;
            }

            .category-card h3 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="preferences-container">
        <div class="preferences-card">
            <div class="preferences-header">
                <span class="logo-icon">‚óà</span>
                <h1>What Are You Interested In?</h1>
                <p>Help us personalize your museum experience by selecting your areas of interest. We'll recommend exhibits, events, and collections tailored just for you.</p>
            </div>

            <div class="welcome-message">
                <h3>Welcome, <span id="userName">Museum Enthusiast</span>!</h3>
                <p>Let's discover what captures your curiosity and passion for history and culture.</p>
            </div>

            <div class="selection-count">
                <p>Select at least <strong>3 categories</strong> that interest you.</p>
                <div class="count-display">
                    You've selected <span class="count" id="selectedCount">0</span> out of <span class="count">9</span> categories.
                </div>
            </div>

            <div class="categories-grid" id="categoriesGrid">
                <div class="category-card" data-category="ancient-civilizations">
                    <div class="category-content">
                        <span class="category-icon">üèõÔ∏è</span>
                        <h3>Ancient Civilizations</h3>
                        <p>Explore the rise and fall of great empires, from Egypt and Rome to Greece and Mesopotamia.</p>
                        <div class="category-details">Includes artifacts, sculptures, and daily life exhibits</div>
                    </div>
                </div>

                <div class="category-card" data-category="medieval-history">
                    <div class="category-content">
                        <span class="category-icon">‚öîÔ∏è</span>
                        <h3>Medieval History</h3>
                        <p>Journey through the Middle Ages with knights, castles, and the transformation of Europe.</p>
                        <div class="category-details">Features armor, manuscripts, and castle reconstructions</div>
                    </div>
                </div>

                <div class="category-card" data-category="renaissance-art">
                    <div class="category-content">
                        <span class="category-icon">üé®</span>
                        <h3>Renaissance Art</h3>
                        <p>Discover masterpieces from the rebirth of art, featuring works by Leonardo, Michelangelo, and more.</p>
                        <div class="category-details">Original paintings, sculptures, and sketches</div>
                    </div>
                </div>

                <div class="category-card" data-category="modern-contemporary">
                    <div class="category-content">
                        <span class="category-icon">üñºÔ∏è</span>
                        <h3>Modern & Contemporary Art</h3>
                        <p>Experience revolutionary movements from Impressionism to Pop Art and beyond.</p>
                        <div class="category-details">Interactive galleries and multimedia installations</div>
                    </div>
                </div>

                <div class="category-card" data-category="natural-history">
                    <div class="category-content">
                        <span class="category-icon">ü¶ï</span>
                        <h3>Natural History</h3>
                        <p>Explore evolution, fossils, and the natural world from dinosaurs to modern ecosystems.</p>
                        <div class="category-details">Fossil displays, dioramas, and hands-on exhibits</div>
                    </div>
                </div>

                <div class="category-card" data-category="science-technology">
                    <div class="category-content">
                        <span class="category-icon">üî¨</span>
                        <h3>Science & Technology</h3>
                        <p>Discover innovations that changed the world, from ancient tools to space exploration.</p>
                        <div class="category-details">Working models and interactive demonstrations</div>
                    </div>
                </div>

                <div class="category-card" data-category="cultural-anthropology">
                    <div class="category-content">
                        <span class="category-icon">üåç</span>
                        <h3>Cultural Anthropology</h3>
                        <p>Learn about diverse cultures, traditions, and ways of life from around the globe.</p>
                        <div class="category-details">Traditional clothing, tools, and ceremonial objects</div>
                    </div>
                </div>

                <div class="category-card" data-category="military-history">
                    <div class="category-content">
                        <span class="category-icon">ü™ñ</span>
                        <h3>Military History</h3>
                        <p>Understand conflicts that shaped nations, from ancient battles to modern warfare.</p>
                        <div class="category-details">Uniforms, weapons, and battle recreations</div>
                    </div>
                </div>

                <div class="category-card" data-category="decorative-arts">
                    <div class="category-content">
                        <span class="category-icon">‚ú®</span>
                        <h3>Decorative Arts</h3>
                        <p>Admire beautiful craftsmanship in jewelry, textiles, ceramics, and luxury objects.</p>
                        <div class="category-details">Fine jewelry, tapestries, and royal collections</div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="continue-button" id="continueButton">
                    <span class="loading">‚ü≥</span>
                    <span class="button-text">Continue to Your Museum Dashboard</span>
                </button>
                <button class="select-all-button" id="selectAllButton">
                    Select All
                </button>
            </div>

            <div class="skip-link">
                <a href="#" id="skipPreferences">Skip for now - I'll explore everything</a>
            </div>
        </div>
    </div>

    <!-- Completion Animation Overlay -->
    <div class="completion-animation" id="completionOverlay">
        <div class="completion-content">
            <div class="success-icon">üéâ</div>
            <h2>Perfect Choices!</h2>
            <p>Your preferences have been saved. Get ready for a personalized museum experience tailored just for you!</p>
        </div>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePreferencesPage();
        });

        function initializePreferencesPage() {
            // Get user data from session storage or URL params
            let userData = {};
            try {
                userData = JSON.parse(sessionStorage.getItem('newUserData')) || {};
            } catch (e) {
                console.log('No user data found, using defaults');
            }

            // Set user name
            const userNameEl = document.getElementById('userName');
            if (userData.username) {
                userNameEl.textContent = userData.username;
            } else if (userData.name) {
                userNameEl.textContent = userData.name;
            }

            // Initialize category selection
            setupCategorySelection();
            
            console.log('Preferences page initialized for user:', userData);
        }

        function setupCategorySelection() {
            const categoryCards = document.querySelectorAll('.category-card');
            const selectedCountEl = document.getElementById('selectedCount');
            const continueButton = document.getElementById('continueButton');
            const selectAllButton = document.getElementById('selectAllButton');
            const skipLink = document.getElementById('skipPreferences');
            
            let selectedCategories = [];
            const minSelection = 3;
            const totalCategories = categoryCards.length;

            // Category selection handler
            categoryCards.forEach(card => {
                card.addEventListener('click', function() {
                    toggleCategorySelection(this);
                });
            });

            function toggleCategorySelection(card) {
                const category = card.dataset.category;
                
                if (card.classList.contains('selected')) {
                    // Deselect
                    card.classList.remove('selected');
                    selectedCategories = selectedCategories.filter(c => c !== category);
                } else {
                    // Select
                    card.classList.add('selected');
                    selectedCategories.push(category);
                }
                
                updateUI();
            }

            function updateUI() {
                // Update counter
                selectedCountEl.textContent = selectedCategories.length;
                
                // Enable/disable continue button
                if (selectedCategories.length >= minSelection) {
                    continueButton.classList.add('enabled');
                } else {
                    continueButton.classList.remove('enabled');
                }

                // Update select all button text
                if (selectedCategories.length === totalCategories) {
                    selectAllButton.textContent = 'Deselect All';
                } else {
                    selectAllButton.textContent = 'Select All';
                }
            }

            // Select/Deselect all button handler
            selectAllButton.addEventListener('click', function() {
                if (selectedCategories.length === totalCategories) {
                    // Deselect all
                    categoryCards.forEach(card => {
                        card.classList.remove('selected');
                    });
                    selectedCategories = [];
                } else {
                    // Select all
                    categoryCards.forEach(card => {
                        if (!card.classList.contains('selected')) {
                            card.classList.add('selected');
                            const category = card.dataset.category;
                            if (!selectedCategories.includes(category)) {
                                selectedCategories.push(category);
                            }
                        }
                    });
                }
                updateUI();
            });

            // Continue button handler
            continueButton.addEventListener('click', function() {
                if (selectedCategories.length >= minSelection) {
                    savePreferencesAndContinue();
                }
            });

            // Skip preferences handler
            skipLink.addEventListener('click', function(e) {
                e.preventDefault();
                handleSkipPreferences();
            });

            function savePreferencesAndContinue() {
                // Show loading state
                continueButton.classList.add('loading');
                continueButton.disabled = true;
                continueButton.querySelector('.button-text').textContent = 'Saving Your Preferences...';

                // Get user data and add preferences
                let userData = {};
                try {
                    userData = JSON.parse(sessionStorage.getItem('newUserData')) || {};
                } catch (e) {
                    userData = {};
                }

                userData.preferences = selectedCategories;
                userData.preferencesDate = new Date().toISOString();
                userData.totalCategories = totalCategories;
                userData.selectedCount = selectedCategories.length;

                // Simulate saving to backend
                setTimeout(() => {
                    // Reset button
                    continueButton.classList.remove('loading');
                    continueButton.disabled = false;
                    continueButton.querySelector('.button-text').textContent = 'Continue to Your Museum Dashboard';

                    // Save to session storage
                    sessionStorage.setItem('userPreferences', JSON.stringify(userData));
                    
                    console.log('Preferences saved:', userData);
                    
                    // Show completion animation
                    showCompletionAnimation(userData);
                    
                }, 1500);
            }

            function handleSkipPreferences() {
                const confirmSkip = confirm(
                    'Are you sure you want to skip selecting your interests?\n\n' +
                    'We can provide much better recommendations and a more personalized experience if you select at least a few categories that interest you.\n\n' +
                    'You can always update your preferences later in your account settings.'
                );
                
                if (confirmSkip) {
                    let userData = {};
                    try {
                        userData = JSON.parse(sessionStorage.getItem('newUserData')) || {};
                    } catch (e) {
                        userData = {};
                    }

                    userData.preferences = [];
                    userData.skippedPreferences = true;
                    userData.preferencesDate = new Date().toISOString();
                    
                    sessionStorage.setItem('userPreferences', JSON.stringify(userData));
                    console.log('User skipped preferences:', userData);
                    
                    // Show brief message and redirect
                    alert('No problem! You can update your preferences anytime in your account settings. Welcome to Heritage Museum!');
                    
                    setTimeout(() => {
                        redirectToMainSite();
                    }, 1000);
                }
            }

            function showCompletionAnimation(userData) {
                const overlay = document.getElementById('completionOverlay');
                const completionContent = overlay.querySelector('.completion-content');
                
                // Update completion message based on selections
                const selectedCount = userData.selectedCount;
                let message = 'Your preferences have been saved. Get ready for a personalized museum experience tailored just for you!';
                
                if (selectedCount === totalCategories) {
                    message = 'Wow! You\'re interested in everything we have to offer. You\'ll get the full Heritage Museum experience!';
                } else if (selectedCount >= 6) {
                    message = 'Excellent! With so many interests, you\'ll have plenty to explore during your visits.';
                } else if (selectedCount >= 4) {
                    message = 'Great choices! We\'ll make sure to highlight exhibits and events that match your interests.';
                }
                
                completionContent.querySelector('p').textContent = message;
                
                // Show overlay
                overlay.style.display = 'flex';
                
                // Auto-hide after 4 seconds and redirect
                setTimeout(() => {
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                        redirectToMainSite();
                    }, 600);
                }, 4000);
            }

            function redirectToMainSite() {
                console.log('Redirecting to museum homepage...');
                
                // In a real application, you would redirect to the main site
                // window.location.href = 'Home.html';
                
                // For demo purposes, show final message
                const finalMessage = `
                    üéâ Welcome to Heritage Museum! üéâ
                    
                    Your account setup is complete!
                    ${selectedCategories.length > 0 ? 
                        `\nYour selected interests:\n‚Ä¢ ${selectedCategories.map(c => 
                            c.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())
                        ).join('\n‚Ä¢ ')}` : 
                        '\nYou can explore all our collections and update your preferences anytime.'
                    }
                    
                    You'll now be redirected to your personalized museum dashboard where you can:
                    ‚Ä¢ Browse recommended exhibits
                    ‚Ä¢ Book tickets for special events
                    ‚Ä¢ Access member-exclusive content
                    ‚Ä¢ Track your visit history
                    
                    Enjoy your journey through history and culture!
                `;
                
                alert(finalMessage);
            }

            // Initialize UI
            updateUI();
        }

        // Add some interactive enhancements
        function addInteractiveEnhancements() {
            // Add hover sound effect simulation
            const categoryCards = document.querySelectorAll('.category-card');
            
            categoryCards.forEach(card => {
                // Add subtle animation on hover
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.transform = 'translateY(0) scale(1)';
                    } else {
                        this.style.transform = 'translateY(-5px) scale(1)';
                    }
                });
                
                // Add click animation
                card.addEventListener('click', function() {
                    // Brief scale animation on click
                    this.style.transform = 'translateY(-5px) scale(0.98)';
                    setTimeout(() => {
                        if (this.classList.contains('selected')) {
                            this.style.transform = 'translateY(-5px) scale(1)';
                        } else {
                            this.style.transform = 'translateY(0) scale(1)';
                        }
                    }, 150);
                });
            });

            // Add progress indicator animation
            const selectedCountEl = document.getElementById('selectedCount');
            const originalUpdateUI = window.updateUI;
            
            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    const focusedCard = document.activeElement;
                    if (focusedCard && focusedCard.classList.contains('category-card')) {
                        e.preventDefault();
                        focusedCard.click();
                    }
                }
            });

            // Make cards keyboard accessible
            categoryCards.forEach((card, index) => {
                card.setAttribute('tabindex', '0');
                card.setAttribute('role', 'button');
                card.setAttribute('aria-label', `Select ${card.querySelector('h3').textContent} category`);
                
                card.addEventListener('focus', function() {
                    this.style.outline = '3px solid var(--accent)';
                    this.style.outlineOffset = '2px';
                });
                
                card.addEventListener('blur', function() {
                    this.style.outline = 'none';
                });
            });
        }

        // Advanced user analytics and recommendations
        function trackUserBehavior() {
            let analytics = {
                pageLoadTime: Date.now(),
                categoryHovers: {},
                selectionOrder: [],
                timeToFirstSelection: null,
                totalTimeOnPage: 0
            };

            const categoryCards = document.querySelectorAll('.category-card');
            
            // Track hover behavior
            categoryCards.forEach(card => {
                const category = card.dataset.category;
                analytics.categoryHovers[category] = 0;
                
                card.addEventListener('mouseenter', function() {
                    analytics.categoryHovers[category]++;
                });
                
                card.addEventListener('click', function() {
                    const isSelecting = !this.classList.contains('selected');
                    
                    if (isSelecting) {
                        analytics.selectionOrder.push({
                            category: category,
                            timestamp: Date.now(),
                            orderIndex: analytics.selectionOrder.length
                        });
                        
                        if (analytics.timeToFirstSelection === null) {
                            analytics.timeToFirstSelection = Date.now() - analytics.pageLoadTime;
                        }
                    } else {
                        // Remove from selection order if deselecting
                        analytics.selectionOrder = analytics.selectionOrder.filter(item => item.category !== category);
                    }
                });
            });

            // Track page unload
            window.addEventListener('beforeunload', function() {
                analytics.totalTimeOnPage = Date.now() - analytics.pageLoadTime;
                console.log('User behavior analytics:', analytics);
                
                // In a real app, send this data to your analytics service
                // sendAnalytics(analytics);
            });

            return analytics;
        }

        // Generate personalized recommendations based on selections
        function generateRecommendations(selectedCategories) {
            const recommendations = {
                exhibits: [],
                events: [],
                collectionsToExplore: [],
                suggestedVisitDuration: '2-3 hours',
                optimalVisitTime: 'Weekday mornings for fewer crowds'
            };

            // Define recommendation mappings
            const exhibitMappings = {
                'ancient-civilizations': [
                    'Treasures of Ancient Rome',
                    'Egyptian Mummies and Sarcophagi',
                    'Greek Sculpture Garden'
                ],
                'medieval-history': [
                    'Knights and Castles Interactive Experience',
                    'Illuminated Manuscripts Collection',
                    'Medieval Weapons and Armor Display'
                ],
                'renaissance-art': [
                    'Renaissance Masters Gallery',
                    'Da Vinci: Genius and Innovation',
                    'Michelangelo Sculpture Replicas'
                ],
                'modern-contemporary': [
                    'Abstract Expressionism Wing',
                    'Pop Art and Consumer Culture',
                    'Contemporary Digital Art Installation'
                ],
                'natural-history': [
                    'Dinosaur Hall',
                    'Evolution and Biodiversity',
                    'Mineral and Gem Collection'
                ],
                'science-technology': [
                    'Space Exploration Timeline',
                    'Industrial Revolution Machines',
                    'Future Technology Preview'
                ],
                'cultural-anthropology': [
                    'World Cultures Gallery',
                    'Traditional Costumes and Textiles',
                    'Ceremonial Objects from Five Continents'
                ],
                'military-history': [
                    'Civil War Battle Diorama',
                    'World War Artifacts Collection',
                    'Uniforms Through the Ages'
                ],
                'decorative-arts': [
                    'Royal Jewelry Collection',
                    'Porcelain and Ceramics Gallery',
                    'Fine Furniture and Tapestries'
                ]
            };

            const eventMappings = {
                'ancient-civilizations': [
                    'Ancient Egypt Night Tour',
                    'Roman History Lecture Series',
                    'Archaeology Workshop'
                ],
                'renaissance-art': [
                    'Renaissance Art Workshop',
                    'Master Painting Techniques Class',
                    'Art History Walking Tour'
                ],
                'natural-history': [
                    'Dinosaur Discovery Day',
                    'Fossil Hunting Workshop',
                    'Nature Photography Exhibition'
                ],
                'science-technology': [
                    'Innovation Lab Open House',
                    'STEM Workshop for Families',
                    'Future Technology Symposium'
                ]
            };

            // Generate recommendations based on selections
            selectedCategories.forEach(category => {
                if (exhibitMappings[category]) {
                    recommendations.exhibits.push(...exhibitMappings[category]);
                }
                if (eventMappings[category]) {
                    recommendations.events.push(...eventMappings[category]);
                }
            });

            // Adjust visit duration based on interests
            if (selectedCategories.length >= 7) {
                recommendations.suggestedVisitDuration = '4-5 hours (full day recommended)';
                recommendations.optimalVisitTime = 'Weekend with early arrival';
            } else if (selectedCategories.length >= 5) {
                recommendations.suggestedVisitDuration = '3-4 hours';
                recommendations.optimalVisitTime = 'Weekend mornings or weekday afternoons';
            }

            // Add complementary categories
            const complementaryMappings = {
                'ancient-civilizations': ['cultural-anthropology', 'decorative-arts'],
                'renaissance-art': ['decorative-arts', 'cultural-anthropology'],
                'natural-history': ['science-technology'],
                'medieval-history': ['military-history', 'decorative-arts']
            };

            selectedCategories.forEach(category => {
                if (complementaryMappings[category]) {
                    complementaryMappings[category].forEach(complementary => {
                        if (!selectedCategories.includes(complementary)) {
                            recommendations.collectionsToExplore.push(
                                complementary.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())
                            );
                        }
                    });
                }
            });

            // Remove duplicates
            recommendations.exhibits = [...new Set(recommendations.exhibits)];
            recommendations.events = [...new Set(recommendations.events)];
            recommendations.collectionsToExplore = [...new Set(recommendations.collectionsToExplore)];

            return recommendations;
        }

        // Enhanced completion sequence
        function showEnhancedCompletion(userData) {
            const recommendations = generateRecommendations(userData.preferences);
            
            // Create detailed completion message
            let completionMessage = `üéâ Welcome to Your Personalized Heritage Museum Experience! üéâ\n\n`;
            
            if (userData.preferences.length > 0) {
                completionMessage += `Based on your interests in:\n`;
                completionMessage += userData.preferences.map(cat => 
                    '‚Ä¢ ' + cat.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())
                ).join('\n');
                
                completionMessage += `\n\nWe recommend:\n\n`;
                
                if (recommendations.exhibits.length > 0) {
                    completionMessage += `üèõÔ∏è Must-See Exhibits:\n`;
                    completionMessage += recommendations.exhibits.slice(0, 3).map(ex => '‚Ä¢ ' + ex).join('\n');
                    completionMessage += '\n\n';
                }
                
                if (recommendations.events.length > 0) {
                    completionMessage += `üìÖ Upcoming Events:\n`;
                    completionMessage += recommendations.events.slice(0, 2).map(ev => '‚Ä¢ ' + ev).join('\n');
                    completionMessage += '\n\n';
                }
                
                completionMessage += `‚è±Ô∏è Suggested Visit Duration: ${recommendations.suggestedVisitDuration}\n`;
                completionMessage += `üïê Best Time to Visit: ${recommendations.optimalVisitTime}\n\n`;
                
                if (recommendations.collectionsToExplore.length > 0) {
                    completionMessage += `üí° You might also enjoy:\n`;
                    completionMessage += recommendations.collectionsToExplore.slice(0, 2).map(col => '‚Ä¢ ' + col).join('\n');
                    completionMessage += '\n\n';
                }
            }
            
            completionMessage += `üé´ Ready to start exploring? Your personalized dashboard awaits!`;
            
            // Store recommendations for later use
            sessionStorage.setItem('userRecommendations', JSON.stringify(recommendations));
            
            return completionMessage;
        }

        // Initialize all enhancements
        document.addEventListener('DOMContentLoaded', function() {
            addInteractiveEnhancements();
            trackUserBehavior();
            
            // Add welcome animation
            setTimeout(() => {
                document.querySelector('.preferences-card').style.animation = 'none';
                document.querySelector('.preferences-card').style.transform = 'translateY(0)';
            }, 600);
        });

        // Export functions for global access
        window.generateRecommendations = generateRecommendations;
        window.showEnhancedCompletion = showEnhancedCompletion;
        
        console.log('Heritage Museum Preferences Page - Enhanced Version Ready');
        console.log('Features: Interactive animations, keyboard navigation, user analytics, personalized recommendations');
    </script>
</body>
</html>